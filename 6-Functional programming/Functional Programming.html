<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rakesh Poduval">
<meta name="dcterms.date" content="2023-09-16">
<meta name="description" content="Workshop series in R programming">

<title>Functional programming</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Functional Programming_files/libs/clipboard/clipboard.min.js"></script>
<script src="Functional Programming_files/libs/quarto-html/quarto.js"></script>
<script src="Functional Programming_files/libs/quarto-html/popper.min.js"></script>
<script src="Functional Programming_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Functional Programming_files/libs/quarto-html/anchor.min.js"></script>
<link href="Functional Programming_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Functional Programming_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Functional Programming_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Functional Programming_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Functional Programming_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#functionals" id="toc-functionals" class="nav-link active" data-scroll-target="#functionals"><span class="header-section-number">1</span> Functionals</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">1.1</span> Introduction</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation"><span class="header-section-number">1.2</span> Motivation</a>
  <ul class="collapse">
  <li><a href="#scenario-1" id="toc-scenario-1" class="nav-link" data-scroll-target="#scenario-1"><span class="header-section-number">1.2.1</span> Scenario 1</a></li>
  <li><a href="#scenario-2" id="toc-scenario-2" class="nav-link" data-scroll-target="#scenario-2"><span class="header-section-number">1.2.2</span> Scenario 2</a></li>
  <li><a href="#scenario-3" id="toc-scenario-3" class="nav-link" data-scroll-target="#scenario-3"><span class="header-section-number">1.2.3</span> Scenario 3</a></li>
  </ul></li>
  <li><a href="#fundamental-concept" id="toc-fundamental-concept" class="nav-link" data-scroll-target="#fundamental-concept"><span class="header-section-number">1.3</span> Fundamental concept</a></li>
  <li><a href="#base-vs.-purrr" id="toc-base-vs.-purrr" class="nav-link" data-scroll-target="#base-vs.-purrr"><span class="header-section-number">1.4</span> Base vs.&nbsp;purrr</a></li>
  <li><a href="#extractions" id="toc-extractions" class="nav-link" data-scroll-target="#extractions"><span class="header-section-number">1.5</span> Extractions</a></li>
  <li><a href="#passing-arguments" id="toc-passing-arguments" class="nav-link" data-scroll-target="#passing-arguments"><span class="header-section-number">1.6</span> Passing arguments</a></li>
  <li><a href="#excercise" id="toc-excercise" class="nav-link" data-scroll-target="#excercise"><span class="header-section-number">1.7</span> Excercise</a></li>
  <li><a href="#map-family" id="toc-map-family" class="nav-link" data-scroll-target="#map-family"><span class="header-section-number">1.8</span> Map family</a></li>
  <li><a href="#reduce-family" id="toc-reduce-family" class="nav-link" data-scroll-target="#reduce-family"><span class="header-section-number">1.9</span> Reduce family</a></li>
  <li><a href="#predicate-functionals" id="toc-predicate-functionals" class="nav-link" data-scroll-target="#predicate-functionals"><span class="header-section-number">1.10</span> Predicate functionals</a></li>
  </ul></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">2</span> Applications</a>
  <ul class="collapse">
  <li><a href="#mle" id="toc-mle" class="nav-link" data-scroll-target="#mle"><span class="header-section-number">2.1</span> MLE</a></li>
  <li><a href="#bias-and-mse" id="toc-bias-and-mse" class="nav-link" data-scroll-target="#bias-and-mse"><span class="header-section-number">2.2</span> Bias and MSE</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">3</span> References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Functional programming</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> show code</button></div></div>
</div>

<div>
  <div class="description">
    Workshop series in R programming
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rakesh Poduval </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 16, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>


<div class="no-row-height column-margin column-container"><div class="">
<dl>
<dt><img src="logo_CUSAT.png" id="fig-logo" width="80" height="80"></dt>
<dd>
<p>DOS-OSF</p>
</dd>
</dl>
</div></div><blockquote class="blockquote">
<p>R, at its heart, is a functional language which lends itself to a problem solving centred on <strong>functions</strong>. A <em>functional style</em> is about decomposing a big problem into smaller pieces, then solving each piece with a function. The three keys functional techniques for this are: <em><code>functionals</code></em>, <em><code>function factories</code></em> &amp; <em><code>function operators</code></em>.</p>
</blockquote>
<section id="functionals" class="level1 page-columns page-full" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Functionals</h1>
<section id="introduction" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1.1</span> Introduction</h2>
<p>A <strong>functional</strong> is a function that takes a function as an input and returns a vector as output. A common use of <strong>functional</strong> is as an alternative to for loops since loops have a bad rap for being slow, although they’re very flexible. Check out an simple examples below.</p>
<p>Calculating mean of random numbers generated:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>randomise <span class="ot">&lt;-</span> <span class="cf">function</span>(f, <span class="at">n =</span> <span class="dv">1000</span>) <span class="fu">f</span>(<span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>))</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">randomise</span>(mean) <span class="co"># iterate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="motivation" class="level2 page-columns page-full" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="motivation"><span class="header-section-number">1.2</span> Motivation</h2>
<section id="scenario-1" class="level3 page-columns page-full" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="scenario-1"><span class="header-section-number">1.2.1</span> Scenario 1</h3>
<blockquote class="blockquote">
<p>Replace missing values (<code>NA</code>s) in the data with 0</p>
</blockquote>
<div class="cell page-columns page-full">
<details>
<summary>show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">set.seed</span>(<span class="dv">1010</span>) <span class="co"># generates same sample</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>dd <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">data.frame</span>(<span class="fu">replicate</span>(<span class="dv">6</span>, <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>), <span class="dv">6</span>, <span class="at">rep =</span> <span class="cn">TRUE</span>))), </span>
<span id="cb2-4"><a href="#cb2-4"></a>  letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb2-5"><a href="#cb2-5"></a>dd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="kable-table">
<div id="tbl-dd" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: Sample data with missings</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">a</th>
<th style="text-align: right;">b</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">d</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">f</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div></div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">copy-paste</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">DRY-principle</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">loop</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">functionals-lapply</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>dd<span class="sc">$</span>b[<span class="fu">is.na</span>(dd<span class="sc">$</span>b)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>dd<span class="sc">$</span>c[<span class="fu">is.na</span>(dd<span class="sc">$</span>c)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>dd<span class="sc">$</span>f[<span class="fu">is.na</span>(dd<span class="sc">$</span>f)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>replaceNA <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">replace_with =</span> <span class="dv">0</span>) {</span>
<span id="cb4-2"><a href="#cb4-2"></a>  x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> replace_with</span>
<span id="cb4-3"><a href="#cb4-3"></a>  x</span>
<span id="cb4-4"><a href="#cb4-4"></a>}</span>
<span id="cb4-5"><a href="#cb4-5"></a>dd<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd<span class="sc">$</span>b)</span>
<span id="cb4-6"><a href="#cb4-6"></a>dd<span class="sc">$</span>c <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd<span class="sc">$</span>c)</span>
<span id="cb4-7"><a href="#cb4-7"></a>dd<span class="sc">$</span>f <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd<span class="sc">$</span>f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>replaceNA <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">replace_with =</span> <span class="dv">0</span>) {</span>
<span id="cb5-2"><a href="#cb5-2"></a>  x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> replace_with</span>
<span id="cb5-3"><a href="#cb5-3"></a>  x</span>
<span id="cb5-4"><a href="#cb5-4"></a>}</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(dd)) {</span>
<span id="cb5-6"><a href="#cb5-6"></a>  dd[, i] <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd[, i])</span>
<span id="cb5-7"><a href="#cb5-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>replaceNA <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">replace_with =</span> <span class="dv">0</span>) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> replace_with</span>
<span id="cb6-3"><a href="#cb6-3"></a>  x</span>
<span id="cb6-4"><a href="#cb6-4"></a>}</span>
<span id="cb6-5"><a href="#cb6-5"></a>dd[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dd, replaceNA)</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co"># dd[c(2, 3, 6)] &lt;- lapply(dd[c(2, 3, 6)], replaceNA)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>This code <code>functionals-lapply</code> has five advantages over others:</p>
<ul>
<li>It’s more compact.</li>
<li>If the code for a missing value changes, it only needs to be updated in one place.</li>
<li>It works for any number of columns. There is no way to accidentally miss a column.</li>
<li>There is no way to accidentally treat one column differently than another.</li>
<li>It is easy to generalise this technique to a subset of columns:</li>
</ul>
</section>
<section id="scenario-2" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="scenario-2"><span class="header-section-number">1.2.2</span> Scenario 2</h3>
<p>Refer <a href="#tbl-dd">Table&nbsp;1</a></p>
<blockquote class="blockquote">
<p>Compute a set of descriptive statistics for each variable in the data</p>
</blockquote>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">copy-paste</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">DRY-principle</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">functionals-lapply</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">min</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># minimum</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">mean</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># average </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">median</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># median </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">max</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># maximum</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="fu">sd</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># standard deviation</span></span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># ... repeat the same for rest of the columns of dd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>descriptive_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">avg =</span> <span class="fu">mean</span>(x, ...), </span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="at">med =</span> <span class="fu">median</span>(x, ...), </span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="at">max =</span> <span class="fu">max</span>(x, ...), <span class="at">std =</span> <span class="fu">sd</span>(x, ...))</span>
<span id="cb8-5"><a href="#cb8-5"></a>  }</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="fu">descriptive_stats</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="fu">descriptive_stats</span>(dd<span class="sc">$</span>b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fu">descriptive_stats</span>(dd<span class="sc">$</span>c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co"># ... repeat the same for rest of the columns of dd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>descriptive_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">avg =</span> <span class="fu">mean</span>(x, ...),</span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="at">med =</span> <span class="fu">median</span>(x, ...), </span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="at">max =</span> <span class="fu">max</span>(x, ...), <span class="at">std =</span> <span class="fu">sd</span>(x, ...))</span>
<span id="cb9-5"><a href="#cb9-5"></a>  }</span>
<span id="cb9-6"><a href="#cb9-6"></a>  </span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="fu">data.frame</span>(<span class="fu">lapply</span>(dd, descriptive_stats, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="fu">data.frame</span>(<span class="fu">apply</span>(dd, <span class="dv">2</span>, descriptive_stats)) <span class="co"># alternatively</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="scenario-3" class="level3 page-columns page-full" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="scenario-3"><span class="header-section-number">1.2.3</span> Scenario 3</h3>
<blockquote class="blockquote">
<p>Compare performace between <code>for</code> loop &amp; <code>apply</code> method for performing <code>t.test</code>.</p>
</blockquote>
<div class="cell page-columns page-full">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>loops vs. apply</strong></pre>
</div>
<div class="sourceCode cell-code" id="annotated-cell-3" data-code-fold="false"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span> <span class="sc">*</span> <span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">1000</span>))</span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2"></a>dd<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3"></a>vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dd), <span class="st">"group"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4"></a>perf <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-3-5" class="code-annotation-target"><a href="#annotated-cell-3-5"></a>  <span class="at">loop =</span> <span class="cf">for</span>(i <span class="cf">in</span> vars) <span class="fu">t.test</span>(<span class="fu">reformulate</span>(<span class="st">"group"</span>, i), dd),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-3-6" class="code-annotation-target"><a href="#annotated-cell-3-6"></a>  <span class="at">apply =</span> <span class="fu">apply</span>(dd[vars], <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">t.test</span>(x, dd[<span class="st">"group"</span>])),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="5" onclick="event.preventDefault();" href="">5</a><span id="annotated-cell-3-7" class="code-annotation-target"><a href="#annotated-cell-3-7"></a>  <span class="at">times =</span> <span class="dv">100</span>)</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8"></a></span>
<span id="annotated-cell-3-9"><a href="#annotated-cell-3-9"></a><span class="fu">library</span>(ggplot2)</span>
<span id="annotated-cell-3-10"><a href="#annotated-cell-3-10"></a><span class="fu">autoplot</span>(perf) <span class="sc">+</span> <span class="fu">theme_grey</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="3" data-code-annotation="1" data-code-cell="annotated-cell-3">Variables apart from <code>group</code></span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="4" data-code-annotation="2" data-code-cell="annotated-cell-3">Function to compare performance (time consumption)</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="5" data-code-annotation="3" data-code-cell="annotated-cell-3"><code>for loop</code> approach</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="6" data-code-annotation="4" data-code-cell="annotated-cell-3"><code>apply</code> approach</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="7" data-code-annotation="5" data-code-cell="annotated-cell-3">Iterating the comparison 100 times</span>
</dd>
</dl>
</div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-perf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Functional-Programming_files/figure-html/fig-perf-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: loops vs.&nbsp;apply</figcaption>
</figure>
</div>
</div></div></div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>copy-paste</strong></pre>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">head</span>(dd)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(dd<span class="sc">$</span>group))</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="fu">t.test</span>(<span class="fu">reformulate</span>(<span class="st">"group"</span>, vars[<span class="dv">1</span>]), dd)</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="fu">t.test</span>(<span class="fu">reformulate</span>(<span class="st">"group"</span>, vars[<span class="dv">2</span>]), dd)</span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co"># ... repeat the same for rest of the vars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="fundamental-concept" class="level2 page-columns page-full" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="fundamental-concept"><span class="header-section-number">1.3</span> Fundamental concept</h2>
<p>We will focus on <em><code>functionals</code></em> provided by the <a href="https://purrr.tidyverse.org">purrr</a> package. These functions (<code>purrr:::map()</code>) have a consistent interface that makes it easier to understand the key ideas than their base equivalents.</p>

<div class="no-row-height column-margin column-container"><div class="">
<dl>
<dt><img src="logo_purrr.png" width="80" height="80"></dt>
<dd>

</dd>
</dl>
</div></div><div id="fig-concept" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 42.0%;justify-content: center;">
<div id="fig-map" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/map.png" class="img-fluid figure-img" data-ref-parent="fig-concept"></p>
<figcaption class="figure-caption">(a) calls the function once for each element</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 58.0%;justify-content: center;">
<div id="fig-maparg" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/map-arg.png" class="img-fluid figure-img" data-ref-parent="fig-concept"></p>
<figcaption class="figure-caption">(b) (a) with single argument of the f()</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 46.0%;justify-content: center;">
<div id="fig-mapargrecycle" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/map-arg-recycle.png" class="img-fluid figure-img" data-ref-parent="fig-concept"></p>
<figcaption class="figure-caption">(c) (a) with multi argument of the f()</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 54.0%;justify-content: center;">
<div id="fig-maplist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/map-list.png" class="img-fluid figure-img" data-ref-parent="fig-concept"></p>
<figcaption class="figure-caption">(d) calls the function once for each list</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: <strong>Design of <code>purrr:::map()</code></strong></figcaption><p></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<blockquote class="blockquote">
<p>All map functions always return an output vector the same length as the input. Here <strong><code>map()</code></strong> refers to <em>“an operation that associates each element of a given set with one or more elements of a second set”</em>. This makes sense here because <code>map()</code> defines a mapping from one vector to another.</p>
</blockquote>
</div></div></section>
<section id="base-vs.-purrr" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="base-vs.-purrr"><span class="header-section-number">1.4</span> Base vs.&nbsp;purrr</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">library</span>(purrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The base equivalent to <code>map()</code> is <code>lapply()</code>. The only difference is that <code>map()</code> has four more specific variants: <code>map_lgl()</code>, <code>map_int()</code>, <code>map_dbl()</code>, and <code>map_chr()</code> which returns an atomic vector of the specified type and not a list like <code>lapply()</code>. Base R has two apply functions <code>sapply()</code> &amp; <code>vapply()</code>. Avoid <code>sapply()</code> because it tries to simplify the result, which makes it difficult to program with. If you don’t want to use <code>purrr</code>, it is recommend to use <code>vapply()</code>. For example, the equivalent to <code>map_dbl(x, mean, na.rm = TRUE)</code> is <code>vapply(x, mean, na.rm = TRUE, FUN.VALUE = double(1))</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">purrr</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># vector operation</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">unction</span>(x) x <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(x) <span class="fu">runif</span>(<span class="dv">2</span>))</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co"># data.frame</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="fu">lapply</span>(mtcars, mean) </span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="fu">apply</span>(mtcars, <span class="dv">2</span>, mean)</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="fu">apply</span>(mtcars, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># vector operation</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(x) x <span class="sc">*</span> <span class="dv">2</span>) </span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">2</span>)) <span class="co"># all purrr functions translate formulas into function</span></span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co"># data.frame</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="fu">map</span>(mtcars, mean) </span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="fu">map_dbl</span>(mtcars, mean)</span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="fu">map_dbl</span>(mtcars, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="fu">map_dbl</span>(mtcars, <span class="sc">~</span> <span class="fu">length</span>(<span class="fu">unique</span>(.x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>One needs to know the expected output type. It’s often useful to switch back to <code>map()</code>, because it can accept any type of output.</p>
</div>
</div>
</section>
<section id="extractions" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="extractions"><span class="header-section-number">1.5</span> Extractions</h2>
<p>The map functions have shortcuts for extracting elements from a vector, powered by <code>purrr::pluck()</code>. You can use</p>
<ul>
<li>a character vector to select elements by name</li>
<li>an integer vector to select by position or</li>
<li>a list to select by both name and position.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">list</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>), <span class="at">z =</span> <span class="st">"a"</span>),</span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">list</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="at">z =</span> <span class="st">"b"</span>),</span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">list</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)))</span>
<span id="cb14-5"><a href="#cb14-5"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">purrr</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="st">"x"</span>]))) <span class="co"># select by name</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="dv">1</span>]))) <span class="co"># select by position</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="fu">as.numeric</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="st">"y"</span>][[<span class="dv">1</span>]][<span class="dv">1</span>])) <span class="co"># select by both</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="fu">as.character</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="st">"z"</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">map_dbl</span>(x, <span class="st">"x"</span>) <span class="co"># select by name</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">map_dbl</span>(x, <span class="dv">1</span>) <span class="co"># select by position</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="fu">map_dbl</span>(x, <span class="fu">list</span>(<span class="st">"y"</span>, <span class="dv">1</span>)) <span class="co"># select by both</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="fu">map_chr</span>(x, <span class="st">"z"</span>) <span class="co"># error if a component doesn't exist</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">map_chr</span>(x, <span class="st">"z"</span>, <span class="at">.default =</span> <span class="cn">NA</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="fu">unlist</span>(<span class="fu">map</span>(x, <span class="st">"z"</span>)) <span class="co"># the safer way</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="passing-arguments" class="level2 page-columns page-full" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="passing-arguments"><span class="header-section-number">1.6</span> Passing arguments</h2>
<p>It’s often required to pass additional arguments to the function that is called.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>))</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">map_dbl</span>(x, <span class="sc">~</span> <span class="fu">mean</span>(.x)) <span class="co"># NA</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">map_dbl</span>(x, <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="fu">map_dbl</span>(x, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># simpler form</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="">
<blockquote class="blockquote">
<p>Any arguments that come after <code>f</code> in the call are inserted <strong><em>after</em></strong> the data in individual calls to <code>f()</code>. Check <a href="#fig-maparg">Figure&nbsp;2 (b)</a>. Note that these arguments are only vectorised over its first argument. If an argument after <code>f</code> is a vector, it will be passed along as is <a href="#fig-maplist">Figure&nbsp;2 (d)</a>.</p>
</blockquote>
</div></div><div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is recommended writing out the full argument names, as it makes it easier to read.</p>
</div>
</div>
<p>So far the first argument to <code>map()</code> has always been the first argument. Imagine a scenario where the first argument should be constant, and a second argument is varying. Refer <a href="#fig-mapargflipped">Figure&nbsp;3</a>. For example let’s say we have a vector that contains a few unusual values, and we want to explore the effect of different amounts of trimming when computing the mean.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-mapargflipped" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/map-arg-flipped.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Varying a second argument</figcaption>
</figure>
</div>
</div></div><div class="sourceCode" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>trims <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a>x <span class="ot">&lt;-</span> <span class="fu">rcauchy</span>(<span class="dv">1000</span>) <span class="co"># Cauchy Distribution</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="fu">map_dbl</span>(trims, <span class="sc">~</span> <span class="fu">mean</span>(x, <span class="at">trim =</span> .x))</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">map_dbl</span>(trims, <span class="cf">function</span>(t) <span class="fu">mean</span>(x, <span class="at">trim =</span> t))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="excercise" class="level2 page-columns page-full" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="excercise"><span class="header-section-number">1.7</span> Excercise</h2>
<p>Let’s use <code>purrr</code> functions to solve a moderately realistic problem. We will fit a model using <code>iris</code> to each subgroup <code>Species</code> and extract the <code>R2</code> &amp; <code>SE</code> from each model.</p>
<p>Steps performed:</p>
<ol type="1">
<li>Split <code>iris</code> by <code>Species</code> - creates a list of 4 <code>data.frames</code></li>
<li>Fit a linear model for each data split with the formula: <code>Sepal.Length ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width</code></li>
<li>Extract performance metrics from each model as mentioned above.</li>
<li>Round the results up to 2 decimal place.</li>
<li>Combine the results into one table for comparison.</li>
</ol>
<div class="tabset-margin-container page-columns page-full"><div class="no-row-height column-margin column-container"><div class="cell-output-display tabset-margin-content tabset-5-1-tab-margin-content">
<div class="kable-table">
<div id="tbl-modelperfbase" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;2: model performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">intercept</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">R2</th>
<th style="text-align: right;">R2adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">2.35</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">versicolor</td>
<td style="text-align: right;">1.90</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">virginica</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">0.75</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="cell-output-display tabset-margin-content tabset-5-2-tab-margin-content collapse">
<div class="kable-table">
<div id="tbl-modelperflapply" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3: model performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">intercept</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">R2</th>
<th style="text-align: right;">R2adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">2.35</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">versicolor</td>
<td style="text-align: right;">1.90</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">virginica</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">0.75</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="cell-output-display tabset-margin-content tabset-5-3-tab-margin-content collapse">
<div class="kable-table">
<div id="tbl-modelperfpurrr" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;4: model performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">intercept</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">R2</th>
<th style="text-align: right;">R2adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">2.35</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">versicolor</td>
<td style="text-align: right;">1.90</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">virginica</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">0.75</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">lapply</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false" href="">purrr</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># data and model calibration</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>dd_list <span class="ot">&lt;-</span> <span class="fu">split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris<span class="sc">$</span>Species)</span>
<span id="cb19-3"><a href="#cb19-3"></a>setosa <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> dd_list[[<span class="st">"setosa"</span>]]))</span>
<span id="cb19-4"><a href="#cb19-4"></a>versicolor <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> dd_list[[<span class="st">"versicolor"</span>]]))</span>
<span id="cb19-5"><a href="#cb19-5"></a>virginica <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> dd_list[[<span class="st">"virginica"</span>]]))</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co"># preparing final output as desired</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>models <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(</span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="fu">cbind.data.frame</span>(</span>
<span id="cb19-10"><a href="#cb19-10"></a>    <span class="at">model =</span> <span class="st">"setosa"</span>,</span>
<span id="cb19-11"><a href="#cb19-11"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(setosa)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]],</span>
<span id="cb19-12"><a href="#cb19-12"></a>    <span class="at">se =</span> setosa[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> setosa[[<span class="st">"r.squared"</span>]],</span>
<span id="cb19-13"><a href="#cb19-13"></a>    <span class="at">R2adj =</span> setosa[[<span class="st">"adj.r.squared"</span>]]),</span>
<span id="cb19-14"><a href="#cb19-14"></a>  <span class="fu">cbind.data.frame</span>(</span>
<span id="cb19-15"><a href="#cb19-15"></a>    <span class="at">model =</span> <span class="st">"versicolor"</span>, </span>
<span id="cb19-16"><a href="#cb19-16"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(versicolor)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]],</span>
<span id="cb19-17"><a href="#cb19-17"></a>    <span class="at">se =</span> versicolor[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> versicolor[[<span class="st">"r.squared"</span>]],</span>
<span id="cb19-18"><a href="#cb19-18"></a>    <span class="at">R2adj =</span> versicolor[[<span class="st">"adj.r.squared"</span>]]),</span>
<span id="cb19-19"><a href="#cb19-19"></a>  <span class="fu">cbind.data.frame</span>(</span>
<span id="cb19-20"><a href="#cb19-20"></a>    <span class="at">model =</span> <span class="st">"virginica"</span>, </span>
<span id="cb19-21"><a href="#cb19-21"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(virginica)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]],</span>
<span id="cb19-22"><a href="#cb19-22"></a>    <span class="at">se =</span> virginica[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> virginica[[<span class="st">"r.squared"</span>]],</span>
<span id="cb19-23"><a href="#cb19-23"></a>    <span class="at">R2adj =</span> virginica[[<span class="st">"adj.r.squared"</span>]]))</span>
<span id="cb19-24"><a href="#cb19-24"></a></span>
<span id="cb19-25"><a href="#cb19-25"></a><span class="co"># some cosmetics </span></span>
<span id="cb19-26"><a href="#cb19-26"></a>models<span class="sc">$</span>intercept <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>intercept, <span class="dv">2</span>)</span>
<span id="cb19-27"><a href="#cb19-27"></a>models<span class="sc">$</span>se <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>se, <span class="dv">2</span>)</span>
<span id="cb19-28"><a href="#cb19-28"></a>models<span class="sc">$</span>R2 <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>R2, <span class="dv">2</span>)</span>
<span id="cb19-29"><a href="#cb19-29"></a>models<span class="sc">$</span>R2adj <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>R2adj, <span class="dv">2</span>)</span>
<span id="cb19-30"><a href="#cb19-30"></a>models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="fu">split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris<span class="sc">$</span>Species) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> x)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">lapply</span>(summary) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(x)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]], </span>
<span id="cb20-7"><a href="#cb20-7"></a>                       <span class="at">se =</span> x[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> x[[<span class="st">"r.squared"</span>]], </span>
<span id="cb20-8"><a href="#cb20-8"></a>                       <span class="at">R2adj =</span> x[[<span class="st">"adj.r.squared"</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">lapply</span>(round, <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"model"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">library</span>(purrr)</span>
<span id="cb21-3"><a href="#cb21-3"></a></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="fu">split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris<span class="sc">$</span>Species) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="fu">map</span>(summary) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">map</span>(<span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(x)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]], </span>
<span id="cb21-8"><a href="#cb21-8"></a>                    <span class="at">se =</span> x[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> x[[<span class="st">"r.squared"</span>]], </span>
<span id="cb21-9"><a href="#cb21-9"></a>                    <span class="at">R2adj =</span> x[[<span class="st">"adj.r.squared"</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="fu">map</span>(round, <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"model"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
</div>
</div>
</div>
</section>
<section id="map-family" class="level2 page-columns page-full" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="map-family"><span class="header-section-number">1.8</span> Map family</h2>
<p>There are 23 primary variants of <code>map()</code> but fortunately, by design of <code>purrr</code> we only need to learn five new ideas:</p>
<ul>
<li><code>modify()</code>: Returns same type as input</li>
<li><code>map2()</code>: Iterate over two inputs</li>
<li><code>imap()</code>: Iterate with an index.</li>
<li><code>walk()</code>: Return nothing</li>
<li><code>pmap()</code>: Iterate over any number of inputs</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<div id="tbl-mapvariants" class="anchored">
<table class="table">
<caption>Table&nbsp;5: Relation between variants</caption>
<thead>
<tr class="header">
<th>arguments</th>
<th>list</th>
<th>same_type</th>
<th>nothing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>map()</code></td>
<td><code>modify()</code></td>
<td><code>walk()</code></td>
</tr>
<tr class="even">
<td>2</td>
<td><code>map2()</code></td>
<td><code>modify2()</code></td>
<td><code>walk2()</code></td>
</tr>
<tr class="odd">
<td>1 + index</td>
<td><code>imap()</code></td>
<td><code>imodify()</code></td>
<td><code>iwalk()</code></td>
</tr>
<tr class="even">
<td>N</td>
<td><code>pmap()</code></td>
<td>—</td>
<td><code>pwalk()</code></td>
</tr>
</tbody>
</table>
</div>
</div></div><p><code>map()</code> always returns a list. <code>modify()</code> returns the same type of output as the input:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">map</span>(dd, <span class="sc">~</span> .x <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># list</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="fu">modify</span>(dd, <span class="sc">~</span> .x <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># data.frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>modify()</code> has a very useful variant of called <code>modify_if()</code> which allows you to (e.g.) only double <em>numeric</em> columns of a data frame with <code>modify_if(dd, is.numeric, ~ .x * 2)</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>), </span>
<span id="cb23-2"><a href="#cb23-2"></a>                 <span class="at">z =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="fu">map_if</span>(dd, is.numeric, mean)</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="fu">modify_if</span>(dd, is.numeric, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>modify()</code> doesn’t modify in place, it returns a modified copy, to make it permanent modify one needs to assign it.</p>
</div>
</div>
<p><code>map()</code> is vectorised over a single argument, <code>.x</code> thus making it poorly suited for some problems. For example, to find a weighted mean when you have a list of observations and a list of weights we need a new tool: a <code>map2()</code>, which is vectorised over two arguments.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-map2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/map2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;4: map2</figcaption>
</figure>
</div>
</div></div><div class="sourceCode" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>x <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">10</span>)) <span class="co"># uniform random numbers</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>w <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">~</span> <span class="fu">rpois</span>(<span class="dv">10</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="dv">1</span>) <span class="co"># poisson random numbers</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="fu">map_dbl</span>(x, weighted.mean, <span class="at">w =</span> w) <span class="co"># error</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="fu">map2_dbl</span>(x, w, weighted.mean) <span class="co"># desired output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The implementation of <code>map2()</code> is quite similar to <code>map()</code>, here instead of iterating over one vector, it iterate over two in parallel. One of the big differences between <code>map2()</code> &amp; <code>map2()</code> is that it recycles its inputs to make sure that they’re the same length.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>purrr</code> provides the walk family of functions that ignore the return values of the <code>.f</code> and instead return <code>.x</code> invisibly</p>
</div>
</div>
<p><code>imap()</code> family is analogous to the to the loop over form <code>for (i in seq_along(x))</code> &amp; <code>for (nm in names(x))</code>. This allows you to iterate over the values and the indices of a vector in parallel.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>x <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="sc">~</span> <span class="fu">sample</span>(<span class="dv">1000</span>, <span class="dv">10</span>))</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">imap_chr</span>(x, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"The highest value of "</span>, .y, <span class="st">" is "</span>, <span class="fu">max</span>(.x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>imap()</code> is useful if you want to work with the values in a vector along with their positions.</p>
</div>
</div>
<p>Since we have <code>map()</code> and <code>map2()</code>, one might expect <code>map3()</code>, <code>map4()</code>, <code>map5()</code>, instead <code>purrr</code> takes a slightly different tack with <code>pmap()</code>: you supply it a single list, which contains any number of arguments. In most cases, that will be a list of equal-length vectors, similar to <code>data.frame</code>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-pmap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/pmap.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;5: pmap</figcaption>
</figure>
</div>
</div></div><div class="callout callout-style-default callout-note callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>map2(x, y, f)</code> is equivalent to <code>pmap(list(x, y), f)</code> <code>map2_dbl(x, w, weighted.mean)</code> is equivalent to <code>pmap_dbl(list(x, w), weighted.mean)</code></p>
</div>
</div>
<p>A big difference between <code>pmap()</code> and the is that <code>pmap()</code> gives you much finer control over argument matching over other map functions because one can name the components of the list.I It’s always a good practice to name the components of the list to make it very clear how the function will be called.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-pmapargs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/pmap-3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6: pmap with arguments</figcaption>
</figure>
</div>
</div></div><div class="sourceCode" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>params <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="sc">~</span> n, <span class="sc">~</span> min, <span class="sc">~</span> max,</span>
<span id="cb26-3"><a href="#cb26-3"></a>   1L,     <span class="dv">0</span>,     <span class="dv">1</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>   2L,    <span class="dv">10</span>,   <span class="dv">100</span>,</span>
<span id="cb26-5"><a href="#cb26-5"></a>   3L,   <span class="dv">100</span>,  <span class="dv">1000</span>)</span>
<span id="cb26-6"><a href="#cb26-6"></a>   </span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="fu">pmap</span>(params, runif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled" title="Caution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here, the column names are critical.</p>
</div>
</div>
</section>
<section id="reduce-family" class="level2 page-columns page-full" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="reduce-family"><span class="header-section-number">1.9</span> Reduce family</h2>
<p>The next most important family of functions is the <code>reduce</code> family. This is smaller, with only two main variants &amp; is less commonly used, but it’s a powerful idea. <code>reduce()</code> takes a vector of length <em>n</em> and produces a vector of length <em>1</em> by calling a function with a pair of values at a time.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-reduce" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="diagrams/reduce.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;7: reduce</figcaption>
</figure>
</div>
</div></div><div class="callout callout-style-default callout-note callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>reduce(1:4, f)</code> is equivalent to <code>f(f(f(1, 2), 3), 4)</code>.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>x <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="at">replace =</span> T))</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">str</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ : int [1:10] 9 1 6 7 3 1 2 2 1 6
 $ : int [1:10] 1 7 8 7 4 7 5 3 6 3
 $ : int [1:10] 8 1 4 4 10 7 6 5 6 10
 $ : int [1:10] 3 8 2 4 6 4 6 2 10 2</code></pre>
</div>
</div>
<p>Let’s find the common observations from the above list</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>The first <code>reduce()</code> variant is <code>accumulate()</code> which it returns all the intermediate results.</p>
</div></div><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">copy-paste</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">loop</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false" href="">reduce</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>out <span class="ot">&lt;-</span> x[[<span class="dv">1</span>]]</span>
<span id="cb29-2"><a href="#cb29-2"></a>out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[<span class="dv">2</span>]])</span>
<span id="cb29-3"><a href="#cb29-3"></a>out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[<span class="dv">3</span>]])</span>
<span id="cb29-4"><a href="#cb29-4"></a>out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[<span class="dv">4</span>]])</span>
<span id="cb29-5"><a href="#cb29-5"></a>out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>out <span class="ot">&lt;-</span> x[[<span class="dv">1</span>]]</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb31-3"><a href="#cb31-3"></a>  out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[i]])</span>
<span id="cb31-4"><a href="#cb31-4"></a>}</span>
<span id="cb31-5"><a href="#cb31-5"></a>out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># accumulate(x, intersect)</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="fu">reduce</span>(x, intersect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<blockquote class="blockquote">
<p><code>map-reduce</code> (map combined with a reduce) is the idea that powers technology like <code>Hadoop</code>. Now you can see how simple and powerful the underlying idea is. As a simple example, imagine computing the mean of a very large vector, so large that it has to be split over multiple computers. You could ask each computer to calculate the sum and the length, and then return those to the coordinator which computes the overall mean by dividing the total sum by the total length.</p>
</blockquote>
</div></div></section>
<section id="predicate-functionals" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="predicate-functionals"><span class="header-section-number">1.10</span> Predicate functionals</h2>
<p>A <strong>predicate</strong> function returns a single <code>TRUE</code> or <code>FALSE</code>, it returns <code>TRUE</code> when it <strong>matches</strong> a vector. It applies a predicate to each element of a vector. <code>purrr</code> provides seven useful functions which come in three groups:</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 32%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>function</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>some(.x, .p)</code></td>
<td>returns <code>TRUE</code> if <strong>any</strong> element matches</td>
</tr>
<tr class="even">
<td></td>
<td><code>every(.x, .p)</code></td>
<td>returns <code>TRUE</code> if <strong>all</strong> element matches.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>none(.x, .p)</code></td>
<td>returns <code>TRUE</code> if <strong>no</strong> element matches</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>detect(.x, .p)</code></td>
<td>returns the <strong>value</strong> of the first match</td>
</tr>
<tr class="odd">
<td></td>
<td><code>detect_index(.x, .p)</code></td>
<td>returns the <strong>location</strong> of the first match</td>
</tr>
<tr class="even">
<td>3</td>
<td><code>keep(.x, .p)</code>.</td>
<td><strong>keeps</strong> all matching elements</td>
</tr>
<tr class="odd">
<td></td>
<td><code>discard(.x, .p)</code></td>
<td><strong>drops</strong> all matching elements</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">detect</span>(dd, is.factor)</span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="fu">detect_index</span>(dd, is.factor)</span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="fu">keep</span>(dd, is.factor)</span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="fu">discard</span>(dd, is.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>map()</code> and <code>modify()</code> also can take predicate functions.</p>
</div>
</div>
</section>
</section>
<section id="applications" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Applications</h1>
<section id="mle" class="level2 page-columns page-full" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="mle"><span class="header-section-number">2.1</span> MLE</h2>
<p>The goal of maximum likelihood estimation (MLE) is to find the parameter values for a distribution that make the observed data most likely. To do MLE, we start with a probability function. For example, let’s take the Poisson distribution. If we know <span class="math inline">\(\lambda\)</span>, we can compute the probability of getting a vector <span class="math inline">\(\mathbf{x}\)</span> of values (<span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, …, <span class="math inline">\(x_n\)</span>) by multiplying the Poisson probability function as follows:</p>
<p><span class="math display">\[
P(\lambda, \mathbf{x}) = \prod_{i=1}^{n} \frac{\lambda ^ {x_i} e^{-\lambda}}{x_i!}
\]</span> Let’s apply a <code>log</code> transformation to this probability function and simplify it as much as possible: <span class="math display">\[
\log(P(\lambda, \mathbf{x})) = \log(\lambda) \sum_{i=1}^{n} x_i - n \lambda - \sum_{i=1}^{n} \log(x_i!)
\]</span></p>
<p>We can now turn this function into an R function.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">#' log_likelihood</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="co">#' @param lambda shape parameter </span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="co">#' @param x input vector</span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="co">#' @return compute the (logged) probability</span></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="co">#' @example</span></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="co">#' log_likelihood(0.3, x = c(2, 1, 3, 0, 2))</span></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="co">#' </span></span>
<span id="cb36-8"><a href="#cb36-8"></a>log_likelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, x) {</span>
<span id="cb36-9"><a href="#cb36-9"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb36-10"><a href="#cb36-10"></a>  (<span class="fu">log</span>(lambda) <span class="sc">*</span> <span class="fu">sum</span>(x)) <span class="sc">-</span> (n <span class="sc">*</span> lambda) <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">lfactorial</span>(x))</span>
<span id="cb36-11"><a href="#cb36-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="">
<blockquote class="blockquote">
<p>The R function is quite elegant because R is vectorised and, because it’s a statistical programming language, R comes with built-in functions like the log-factorial (<code>lfactorial()</code>).</p>
</blockquote>
</div></div><p>So far we’ve been thinking of <code>lambda</code> as fixed &amp; known &amp; the function gives us the <em>probability of getting different values of <code>x</code></em>. But in real-life, we observe <code>x</code> and it is <code>lambda</code> that is unknown. We want to find the <code>lambda</code> that makes the observed <code>x</code> the most likely. That is, given <code>x</code>, what value of <code>lambda</code> gives us the highest value of <code>log_likelihood</code>()?</p>
<div class="sourceCode" id="annotated-cell-17"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-17-1" class="code-annotation-target"><a href="#annotated-cell-17-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">lambda =</span> <span class="fl">0.3</span>)</span>
<span id="annotated-cell-17-2"><a href="#annotated-cell-17-2"></a>lambda <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="annotated-cell-17-3"><a href="#annotated-cell-17-3"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-17-4" class="code-annotation-target"><a href="#annotated-cell-17-4"></a>M <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(lambda, <span class="sc">~</span><span class="fu">log_likelihood</span>(<span class="at">lambda =</span> .x, X))</span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5"></a>best_value <span class="ot">&lt;-</span> lambda[M <span class="sc">==</span> <span class="fu">reduce</span>(M, max)]</span>
<span id="annotated-cell-17-6"><a href="#annotated-cell-17-6"></a></span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7"></a><span class="co"># alternate approach</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-17-8" class="code-annotation-target"><a href="#annotated-cell-17-8"></a><span class="fu">optimise</span>(log_likelihood, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">x =</span> X, <span class="at">maximum =</span> <span class="cn">TRUE</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1,2" data-code-annotation="1" data-code-cell="annotated-cell-17">Generate poisson random numbers &amp; selecting a random set of <code>lambda</code></span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="4,5" data-code-annotation="2" data-code-cell="annotated-cell-17">Finding the best value.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="8" data-code-annotation="3" data-code-cell="annotated-cell-17">Automates the process of finding the best value. It will evaluate <code>log_likelihood()</code> many times, using mathematical tricks to narrow in on the largest value as quickly as possible</span>
</dd>
</dl>
</section>
<section id="bias-and-mse" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="bias-and-mse"><span class="header-section-number">2.2</span> Bias and MSE</h2>
</section>
</section>
<section id="references" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> References</h1>
<p><a href="https://purrr.tidyverse.org/reference/index.html" class="uri">https://purrr.tidyverse.org/reference/index.html</a></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="an">title:</span><span class="co"> "Functional programming"</span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="an">author:</span><span class="co"> "Rakesh Poduval"</span></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="an">description:</span><span class="co"> "Workshop series in R programming"</span></span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="an">date:</span><span class="co"> 9/16/2023</span></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="an">format:</span></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="co">  html:</span></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="co">    theme: default</span></span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="co">    page-layout: article</span></span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="co">    grid:</span></span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="co">      sidebar-width: 250px</span></span>
<span id="cb37-12"><a href="#cb37-12"></a><span class="co">      body-width: 800px</span></span>
<span id="cb37-13"><a href="#cb37-13"></a><span class="co">      margin-width: 250px</span></span>
<span id="cb37-14"><a href="#cb37-14"></a><span class="co">      gutter-width: 1.5em</span></span>
<span id="cb37-15"><a href="#cb37-15"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb37-16"><a href="#cb37-16"></a><span class="co">    anchor-sections: true</span></span>
<span id="cb37-17"><a href="#cb37-17"></a><span class="co">    toc: true</span></span>
<span id="cb37-18"><a href="#cb37-18"></a><span class="co">    toc-expand: 2</span></span>
<span id="cb37-19"><a href="#cb37-19"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb37-20"><a href="#cb37-20"></a><span class="co">    toc-location: left</span></span>
<span id="cb37-21"><a href="#cb37-21"></a><span class="co">    number-sections: true</span></span>
<span id="cb37-22"><a href="#cb37-22"></a><span class="co">    number-depth: 3</span></span>
<span id="cb37-23"><a href="#cb37-23"></a><span class="co">    code-fold: false</span></span>
<span id="cb37-24"><a href="#cb37-24"></a><span class="co">    code-summary: "show code"</span></span>
<span id="cb37-25"><a href="#cb37-25"></a><span class="co">    code-annotations: below</span></span>
<span id="cb37-26"><a href="#cb37-26"></a><span class="co">    code-copy: true</span></span>
<span id="cb37-27"><a href="#cb37-27"></a><span class="co">    code-tools:</span></span>
<span id="cb37-28"><a href="#cb37-28"></a><span class="co">      source: true</span></span>
<span id="cb37-29"><a href="#cb37-29"></a><span class="co">      toggle: false</span></span>
<span id="cb37-30"><a href="#cb37-30"></a><span class="co">      caption: "show code"</span></span>
<span id="cb37-31"><a href="#cb37-31"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb37-32"><a href="#cb37-32"></a><span class="co">    df-print: kable</span></span>
<span id="cb37-33"><a href="#cb37-33"></a><span class="co">    fig-cap-location: bottom</span></span>
<span id="cb37-34"><a href="#cb37-34"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb37-35"><a href="#cb37-35"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb37-36"><a href="#cb37-36"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb37-37"><a href="#cb37-37"></a><span class="co">---</span></span>
<span id="cb37-38"><a href="#cb37-38"></a></span>
<span id="cb37-39"><a href="#cb37-39"></a>::: column-margin</span>
<span id="cb37-40"><a href="#cb37-40"></a></span>
<span id="cb37-41"><a href="#cb37-41"></a><span class="al">![](logo_CUSAT.png)</span>{#fig-logo width="80" height="80"}</span>
<span id="cb37-42"><a href="#cb37-42"></a></span>
<span id="cb37-43"><a href="#cb37-43"></a>:   DOS-OSF</span>
<span id="cb37-44"><a href="#cb37-44"></a>:::</span>
<span id="cb37-45"><a href="#cb37-45"></a></span>
<span id="cb37-46"><a href="#cb37-46"></a><span class="at">&gt; R, at its heart, is a functional language which lends itself to a problem solving centred on **functions**. A *functional style* is about decomposing a big problem into smaller pieces, then solving each piece with a function. The three keys functional techniques for this are: *`functionals`*, *`function factories`* &amp; *`function operators`*.</span></span>
<span id="cb37-47"><a href="#cb37-47"></a></span>
<span id="cb37-48"><a href="#cb37-48"></a><span class="fu"># Functionals</span></span>
<span id="cb37-49"><a href="#cb37-49"></a></span>
<span id="cb37-50"><a href="#cb37-50"></a><span class="fu">## Introduction</span></span>
<span id="cb37-51"><a href="#cb37-51"></a></span>
<span id="cb37-52"><a href="#cb37-52"></a>A **functional** is a function that takes a function as an input and returns a vector as output. A common use of **functional** is as an alternative to for loops since loops have a bad rap for being slow, although they're very flexible. Check out an simple examples below.</span>
<span id="cb37-53"><a href="#cb37-53"></a></span>
<span id="cb37-54"><a href="#cb37-54"></a>Calculating mean of random numbers generated:</span>
<span id="cb37-55"><a href="#cb37-55"></a></span>
<span id="cb37-56"><a href="#cb37-56"></a><span class="in">``` r</span></span>
<span id="cb37-57"><a href="#cb37-57"></a>randomise <span class="ot">&lt;-</span> <span class="cf">function</span>(f, <span class="at">n =</span> <span class="dv">1000</span>) <span class="fu">f</span>(<span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>))</span>
<span id="cb37-58"><a href="#cb37-58"></a><span class="fu">randomise</span>(mean) <span class="co"># iterate</span></span>
<span id="cb37-59"><a href="#cb37-59"></a><span class="in">```</span></span>
<span id="cb37-60"><a href="#cb37-60"></a></span>
<span id="cb37-61"><a href="#cb37-61"></a><span class="fu">## Motivation</span></span>
<span id="cb37-62"><a href="#cb37-62"></a></span>
<span id="cb37-63"><a href="#cb37-63"></a><span class="fu">### Scenario 1</span></span>
<span id="cb37-64"><a href="#cb37-64"></a></span>
<span id="cb37-65"><a href="#cb37-65"></a><span class="at">&gt; Replace missing values (</span><span class="in">`NA`</span><span class="at">s) in the data with 0</span></span>
<span id="cb37-66"><a href="#cb37-66"></a></span>
<span id="cb37-67"><a href="#cb37-67"></a><span class="in">```{r, include=TRUE}</span></span>
<span id="cb37-68"><a href="#cb37-68"></a><span class="co">#| code-fold: true</span></span>
<span id="cb37-69"><a href="#cb37-69"></a><span class="co">#| label: tbl-dd</span></span>
<span id="cb37-70"><a href="#cb37-70"></a><span class="co">#| tbl-cap: Sample data with missings</span></span>
<span id="cb37-71"><a href="#cb37-71"></a><span class="co">#| tbl-colwidths: [30,70]</span></span>
<span id="cb37-72"><a href="#cb37-72"></a><span class="co">#| column: margin</span></span>
<span id="cb37-73"><a href="#cb37-73"></a><span class="fu">set.seed</span>(<span class="dv">1010</span>) <span class="co"># generates same sample</span></span>
<span id="cb37-74"><a href="#cb37-74"></a>dd <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb37-75"><a href="#cb37-75"></a>  <span class="fu">data.frame</span>(<span class="fu">replicate</span>(<span class="dv">6</span>, <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>), <span class="dv">6</span>, <span class="at">rep =</span> <span class="cn">TRUE</span>))), </span>
<span id="cb37-76"><a href="#cb37-76"></a>  letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb37-77"><a href="#cb37-77"></a>dd</span>
<span id="cb37-78"><a href="#cb37-78"></a><span class="in">```</span></span>
<span id="cb37-79"><a href="#cb37-79"></a></span>
<span id="cb37-80"><a href="#cb37-80"></a>::: panel-tabset</span>
<span id="cb37-81"><a href="#cb37-81"></a><span class="fu">#### copy-paste</span></span>
<span id="cb37-82"><a href="#cb37-82"></a></span>
<span id="cb37-83"><a href="#cb37-83"></a><span class="in">``` r</span></span>
<span id="cb37-84"><a href="#cb37-84"></a>dd<span class="sc">$</span>b[<span class="fu">is.na</span>(dd<span class="sc">$</span>b)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-85"><a href="#cb37-85"></a>dd<span class="sc">$</span>c[<span class="fu">is.na</span>(dd<span class="sc">$</span>c)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-86"><a href="#cb37-86"></a>dd<span class="sc">$</span>f[<span class="fu">is.na</span>(dd<span class="sc">$</span>f)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-87"><a href="#cb37-87"></a><span class="in">```</span></span>
<span id="cb37-88"><a href="#cb37-88"></a></span>
<span id="cb37-89"><a href="#cb37-89"></a><span class="fu">#### DRY-principle</span></span>
<span id="cb37-90"><a href="#cb37-90"></a></span>
<span id="cb37-91"><a href="#cb37-91"></a><span class="in">``` r</span></span>
<span id="cb37-92"><a href="#cb37-92"></a>replaceNA <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">replace_with =</span> <span class="dv">0</span>) {</span>
<span id="cb37-93"><a href="#cb37-93"></a>  x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> replace_with</span>
<span id="cb37-94"><a href="#cb37-94"></a>  x</span>
<span id="cb37-95"><a href="#cb37-95"></a>}</span>
<span id="cb37-96"><a href="#cb37-96"></a>dd<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd<span class="sc">$</span>b)</span>
<span id="cb37-97"><a href="#cb37-97"></a>dd<span class="sc">$</span>c <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd<span class="sc">$</span>c)</span>
<span id="cb37-98"><a href="#cb37-98"></a>dd<span class="sc">$</span>f <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd<span class="sc">$</span>f)</span>
<span id="cb37-99"><a href="#cb37-99"></a><span class="in">```</span></span>
<span id="cb37-100"><a href="#cb37-100"></a></span>
<span id="cb37-101"><a href="#cb37-101"></a><span class="fu">#### loop</span></span>
<span id="cb37-102"><a href="#cb37-102"></a></span>
<span id="cb37-103"><a href="#cb37-103"></a><span class="in">``` r</span></span>
<span id="cb37-104"><a href="#cb37-104"></a>replaceNA <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">replace_with =</span> <span class="dv">0</span>) {</span>
<span id="cb37-105"><a href="#cb37-105"></a>  x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> replace_with</span>
<span id="cb37-106"><a href="#cb37-106"></a>  x</span>
<span id="cb37-107"><a href="#cb37-107"></a>}</span>
<span id="cb37-108"><a href="#cb37-108"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(dd)) {</span>
<span id="cb37-109"><a href="#cb37-109"></a>  dd[, i] <span class="ot">&lt;-</span> <span class="fu">replaceNA</span>(dd[, i])</span>
<span id="cb37-110"><a href="#cb37-110"></a>}</span>
<span id="cb37-111"><a href="#cb37-111"></a><span class="in">```</span></span>
<span id="cb37-112"><a href="#cb37-112"></a></span>
<span id="cb37-113"><a href="#cb37-113"></a><span class="fu">#### functionals-lapply</span></span>
<span id="cb37-114"><a href="#cb37-114"></a></span>
<span id="cb37-115"><a href="#cb37-115"></a><span class="in">``` r</span></span>
<span id="cb37-116"><a href="#cb37-116"></a>replaceNA <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">replace_with =</span> <span class="dv">0</span>) {</span>
<span id="cb37-117"><a href="#cb37-117"></a>  x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> replace_with</span>
<span id="cb37-118"><a href="#cb37-118"></a>  x</span>
<span id="cb37-119"><a href="#cb37-119"></a>}</span>
<span id="cb37-120"><a href="#cb37-120"></a>dd[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dd, replaceNA)</span>
<span id="cb37-121"><a href="#cb37-121"></a><span class="co"># dd[c(2, 3, 6)] &lt;- lapply(dd[c(2, 3, 6)], replaceNA)</span></span>
<span id="cb37-122"><a href="#cb37-122"></a><span class="in">```</span></span>
<span id="cb37-123"><a href="#cb37-123"></a>:::</span>
<span id="cb37-124"><a href="#cb37-124"></a></span>
<span id="cb37-125"><a href="#cb37-125"></a>This code <span class="in">`functionals-lapply`</span> has five advantages over others:</span>
<span id="cb37-126"><a href="#cb37-126"></a></span>
<span id="cb37-127"><a href="#cb37-127"></a><span class="ss">-   </span>It's more compact.</span>
<span id="cb37-128"><a href="#cb37-128"></a><span class="ss">-   </span>If the code for a missing value changes, it only needs to be updated in one place.</span>
<span id="cb37-129"><a href="#cb37-129"></a><span class="ss">-   </span>It works for any number of columns. There is no way to accidentally miss a column.</span>
<span id="cb37-130"><a href="#cb37-130"></a><span class="ss">-   </span>There is no way to accidentally treat one column differently than another.</span>
<span id="cb37-131"><a href="#cb37-131"></a><span class="ss">-   </span>It is easy to generalise this technique to a subset of columns:</span>
<span id="cb37-132"><a href="#cb37-132"></a></span>
<span id="cb37-133"><a href="#cb37-133"></a><span class="fu">### Scenario 2</span></span>
<span id="cb37-134"><a href="#cb37-134"></a></span>
<span id="cb37-135"><a href="#cb37-135"></a>Refer @tbl-dd</span>
<span id="cb37-136"><a href="#cb37-136"></a></span>
<span id="cb37-137"><a href="#cb37-137"></a><span class="at">&gt; Compute a set of descriptive statistics for each variable in the data</span></span>
<span id="cb37-138"><a href="#cb37-138"></a></span>
<span id="cb37-139"><a href="#cb37-139"></a>::: panel-tabset</span>
<span id="cb37-140"><a href="#cb37-140"></a><span class="fu">#### copy-paste</span></span>
<span id="cb37-141"><a href="#cb37-141"></a></span>
<span id="cb37-142"><a href="#cb37-142"></a><span class="in">``` r</span></span>
<span id="cb37-143"><a href="#cb37-143"></a><span class="fu">min</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># minimum</span></span>
<span id="cb37-144"><a href="#cb37-144"></a><span class="fu">mean</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># average </span></span>
<span id="cb37-145"><a href="#cb37-145"></a><span class="fu">median</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># median </span></span>
<span id="cb37-146"><a href="#cb37-146"></a><span class="fu">max</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># maximum</span></span>
<span id="cb37-147"><a href="#cb37-147"></a><span class="fu">sd</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># standard deviation</span></span>
<span id="cb37-148"><a href="#cb37-148"></a></span>
<span id="cb37-149"><a href="#cb37-149"></a><span class="co"># ... repeat the same for rest of the columns of dd</span></span>
<span id="cb37-150"><a href="#cb37-150"></a><span class="in">```</span></span>
<span id="cb37-151"><a href="#cb37-151"></a></span>
<span id="cb37-152"><a href="#cb37-152"></a><span class="fu">#### DRY-principle</span></span>
<span id="cb37-153"><a href="#cb37-153"></a></span>
<span id="cb37-154"><a href="#cb37-154"></a><span class="in">``` r</span></span>
<span id="cb37-155"><a href="#cb37-155"></a>descriptive_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb37-156"><a href="#cb37-156"></a>  <span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">avg =</span> <span class="fu">mean</span>(x, ...), </span>
<span id="cb37-157"><a href="#cb37-157"></a>    <span class="at">med =</span> <span class="fu">median</span>(x, ...), </span>
<span id="cb37-158"><a href="#cb37-158"></a>    <span class="at">max =</span> <span class="fu">max</span>(x, ...), <span class="at">std =</span> <span class="fu">sd</span>(x, ...))</span>
<span id="cb37-159"><a href="#cb37-159"></a>  }</span>
<span id="cb37-160"><a href="#cb37-160"></a><span class="fu">descriptive_stats</span>(dd<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-161"><a href="#cb37-161"></a><span class="fu">descriptive_stats</span>(dd<span class="sc">$</span>b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-162"><a href="#cb37-162"></a><span class="fu">descriptive_stats</span>(dd<span class="sc">$</span>c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-163"><a href="#cb37-163"></a></span>
<span id="cb37-164"><a href="#cb37-164"></a><span class="co"># ... repeat the same for rest of the columns of dd</span></span>
<span id="cb37-165"><a href="#cb37-165"></a><span class="in">```</span></span>
<span id="cb37-166"><a href="#cb37-166"></a></span>
<span id="cb37-167"><a href="#cb37-167"></a><span class="fu">#### functionals-lapply</span></span>
<span id="cb37-168"><a href="#cb37-168"></a></span>
<span id="cb37-169"><a href="#cb37-169"></a><span class="in">``` r</span></span>
<span id="cb37-170"><a href="#cb37-170"></a>descriptive_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb37-171"><a href="#cb37-171"></a>  <span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x, ...), <span class="at">avg =</span> <span class="fu">mean</span>(x, ...),</span>
<span id="cb37-172"><a href="#cb37-172"></a>    <span class="at">med =</span> <span class="fu">median</span>(x, ...), </span>
<span id="cb37-173"><a href="#cb37-173"></a>    <span class="at">max =</span> <span class="fu">max</span>(x, ...), <span class="at">std =</span> <span class="fu">sd</span>(x, ...))</span>
<span id="cb37-174"><a href="#cb37-174"></a>  }</span>
<span id="cb37-175"><a href="#cb37-175"></a>  </span>
<span id="cb37-176"><a href="#cb37-176"></a><span class="fu">data.frame</span>(<span class="fu">lapply</span>(dd, descriptive_stats, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-177"><a href="#cb37-177"></a><span class="fu">data.frame</span>(<span class="fu">apply</span>(dd, <span class="dv">2</span>, descriptive_stats)) <span class="co"># alternatively</span></span>
<span id="cb37-178"><a href="#cb37-178"></a><span class="in">```</span></span>
<span id="cb37-179"><a href="#cb37-179"></a>:::</span>
<span id="cb37-180"><a href="#cb37-180"></a></span>
<span id="cb37-181"><a href="#cb37-181"></a><span class="fu">### Scenario 3</span></span>
<span id="cb37-182"><a href="#cb37-182"></a></span>
<span id="cb37-183"><a href="#cb37-183"></a><span class="at">&gt; Compare performace between </span><span class="in">`for`</span><span class="at"> loop &amp; </span><span class="in">`apply`</span><span class="at"> method for performing </span><span class="in">`t.test`</span><span class="at">.</span></span>
<span id="cb37-184"><a href="#cb37-184"></a></span>
<span id="cb37-185"><a href="#cb37-185"></a><span class="in">```{r filename="loops vs. apply"}</span></span>
<span id="cb37-186"><a href="#cb37-186"></a><span class="co">#| label: fig-perf</span></span>
<span id="cb37-187"><a href="#cb37-187"></a><span class="co">#| column: margin</span></span>
<span id="cb37-188"><a href="#cb37-188"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-189"><a href="#cb37-189"></a><span class="co">#| fig-cap: "loops vs. apply" </span></span>
<span id="cb37-190"><a href="#cb37-190"></a></span>
<span id="cb37-191"><a href="#cb37-191"></a>dd <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span> <span class="sc">*</span> <span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">1000</span>))</span>
<span id="cb37-192"><a href="#cb37-192"></a>dd<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-193"><a href="#cb37-193"></a>vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dd), <span class="st">"group"</span>) <span class="co"># &lt;1&gt;</span></span>
<span id="cb37-194"><a href="#cb37-194"></a>perf <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>( <span class="co"># &lt;2&gt;</span></span>
<span id="cb37-195"><a href="#cb37-195"></a>  <span class="at">loop =</span> <span class="cf">for</span>(i <span class="cf">in</span> vars) <span class="fu">t.test</span>(<span class="fu">reformulate</span>(<span class="st">"group"</span>, i), dd), <span class="co"># &lt;3&gt;</span></span>
<span id="cb37-196"><a href="#cb37-196"></a>  <span class="at">apply =</span> <span class="fu">apply</span>(dd[vars], <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">t.test</span>(x, dd[<span class="st">"group"</span>])), <span class="co"># &lt;4&gt;</span></span>
<span id="cb37-197"><a href="#cb37-197"></a>  <span class="at">times =</span> <span class="dv">100</span>) <span class="co"># &lt;5&gt;</span></span>
<span id="cb37-198"><a href="#cb37-198"></a></span>
<span id="cb37-199"><a href="#cb37-199"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb37-200"><a href="#cb37-200"></a><span class="fu">autoplot</span>(perf) <span class="sc">+</span> <span class="fu">theme_grey</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb37-201"><a href="#cb37-201"></a><span class="in">```</span></span>
<span id="cb37-202"><a href="#cb37-202"></a><span class="ss">1. </span>Variables apart from <span class="in">`group`</span></span>
<span id="cb37-203"><a href="#cb37-203"></a><span class="ss">2. </span>Function to compare performance (time consumption)</span>
<span id="cb37-204"><a href="#cb37-204"></a><span class="ss">3. </span><span class="in">`for loop`</span> approach</span>
<span id="cb37-205"><a href="#cb37-205"></a><span class="ss">4. </span><span class="in">`apply`</span> approach</span>
<span id="cb37-206"><a href="#cb37-206"></a><span class="ss">5. </span>Iterating the comparison 100 times</span>
<span id="cb37-207"><a href="#cb37-207"></a></span>
<span id="cb37-208"><a href="#cb37-208"></a><span class="in">```{.r filename="copy-paste"}</span></span>
<span id="cb37-209"><a href="#cb37-209"></a><span class="fu">head</span>(dd)</span>
<span id="cb37-210"><a href="#cb37-210"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(dd<span class="sc">$</span>group))</span>
<span id="cb37-211"><a href="#cb37-211"></a><span class="fu">t.test</span>(<span class="fu">reformulate</span>(<span class="st">"group"</span>, vars[<span class="dv">1</span>]), dd)</span>
<span id="cb37-212"><a href="#cb37-212"></a><span class="fu">t.test</span>(<span class="fu">reformulate</span>(<span class="st">"group"</span>, vars[<span class="dv">2</span>]), dd)</span>
<span id="cb37-213"><a href="#cb37-213"></a></span>
<span id="cb37-214"><a href="#cb37-214"></a><span class="co"># ... repeat the same for rest of the vars</span></span>
<span id="cb37-215"><a href="#cb37-215"></a><span class="in">```</span></span>
<span id="cb37-216"><a href="#cb37-216"></a></span>
<span id="cb37-217"><a href="#cb37-217"></a><span class="fu">## Fundamental concept</span></span>
<span id="cb37-218"><a href="#cb37-218"></a></span>
<span id="cb37-219"><a href="#cb37-219"></a>We will focus on *`functionals`* provided by the <span class="co">[</span><span class="ot">purrr</span><span class="co">](https://purrr.tidyverse.org)</span> package. These functions (<span class="in">`purrr:::map()`</span>) have a consistent interface that makes it easier to understand the key ideas than their base equivalents.</span>
<span id="cb37-220"><a href="#cb37-220"></a></span>
<span id="cb37-221"><a href="#cb37-221"></a>::: column-margin</span>
<span id="cb37-222"><a href="#cb37-222"></a></span>
<span id="cb37-223"><a href="#cb37-223"></a><span class="al">![](logo_purrr.png)</span>{width="80" height="80"}</span>
<span id="cb37-224"><a href="#cb37-224"></a></span>
<span id="cb37-225"><a href="#cb37-225"></a>:   </span>
<span id="cb37-226"><a href="#cb37-226"></a>:::</span>
<span id="cb37-227"><a href="#cb37-227"></a></span>
<span id="cb37-228"><a href="#cb37-228"></a>::: {#fig-concept layout="[<span class="co">[</span><span class="ot">42,58</span><span class="co">]</span>, <span class="co">[</span><span class="ot">46, 54</span><span class="co">]</span>]"}</span>
<span id="cb37-229"><a href="#cb37-229"></a><span class="al">![calls the function once for each element](diagrams/map.png)</span>{#fig-map}</span>
<span id="cb37-230"><a href="#cb37-230"></a></span>
<span id="cb37-231"><a href="#cb37-231"></a><span class="al">![(a) with single argument of the f()](diagrams/map-arg.png)</span>{#fig-maparg}</span>
<span id="cb37-232"><a href="#cb37-232"></a></span>
<span id="cb37-233"><a href="#cb37-233"></a><span class="al">![(a) with multi argument of the f()](diagrams/map-arg-recycle.png)</span>{#fig-mapargrecycle}</span>
<span id="cb37-234"><a href="#cb37-234"></a></span>
<span id="cb37-235"><a href="#cb37-235"></a><span class="al">![calls the function once for each list](diagrams/map-list.png)</span>{#fig-maplist}</span>
<span id="cb37-236"><a href="#cb37-236"></a></span>
<span id="cb37-237"><a href="#cb37-237"></a>**Design of `purrr:::map()`**</span>
<span id="cb37-238"><a href="#cb37-238"></a>:::</span>
<span id="cb37-239"><a href="#cb37-239"></a></span>
<span id="cb37-240"><a href="#cb37-240"></a>::: column-margin</span>
<span id="cb37-241"><a href="#cb37-241"></a><span class="at">&gt; All map functions always return an output vector the same length as the input. Here **`map()`** refers to *"an operation that associates each element of a given set with one or more elements of a second set"*. This makes sense here because </span><span class="in">`map()`</span><span class="at"> defines a mapping from one vector to another.</span></span>
<span id="cb37-242"><a href="#cb37-242"></a><span class="at">:::</span></span>
<span id="cb37-243"><a href="#cb37-243"></a></span>
<span id="cb37-244"><a href="#cb37-244"></a><span class="fu">## Base vs. purrr</span></span>
<span id="cb37-245"><a href="#cb37-245"></a></span>
<span id="cb37-246"><a href="#cb37-246"></a><span class="in">``` r</span></span>
<span id="cb37-247"><a href="#cb37-247"></a><span class="fu">library</span>(purrr)</span>
<span id="cb37-248"><a href="#cb37-248"></a><span class="in">```</span></span>
<span id="cb37-249"><a href="#cb37-249"></a></span>
<span id="cb37-250"><a href="#cb37-250"></a>The base equivalent to <span class="in">`map()`</span> is <span class="in">`lapply()`</span>. The only difference is that <span class="in">`map()`</span> has four more specific variants: <span class="in">`map_lgl()`</span>, <span class="in">`map_int()`</span>, <span class="in">`map_dbl()`</span>, and <span class="in">`map_chr()`</span> which returns an atomic vector of the specified type and not a list like <span class="in">`lapply()`</span>. Base R has two apply functions <span class="in">`sapply()`</span> &amp; <span class="in">`vapply()`</span>. Avoid <span class="in">`sapply()`</span> because it tries to simplify the result, which makes it difficult to program with. If you don't want to use <span class="in">`purrr`</span>, it is recommend to use <span class="in">`vapply()`</span>. For example, the equivalent to <span class="in">`map_dbl(x, mean, na.rm = TRUE)`</span> is <span class="in">`vapply(x, mean, na.rm = TRUE, FUN.VALUE = double(1))`</span>.</span>
<span id="cb37-251"><a href="#cb37-251"></a></span>
<span id="cb37-252"><a href="#cb37-252"></a>::: panel-tabset</span>
<span id="cb37-253"><a href="#cb37-253"></a></span>
<span id="cb37-254"><a href="#cb37-254"></a><span class="fu">### base</span></span>
<span id="cb37-255"><a href="#cb37-255"></a></span>
<span id="cb37-256"><a href="#cb37-256"></a><span class="in">``` r</span></span>
<span id="cb37-257"><a href="#cb37-257"></a><span class="co"># vector operation</span></span>
<span id="cb37-258"><a href="#cb37-258"></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">unction</span>(x) x <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb37-259"><a href="#cb37-259"></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(x) <span class="fu">runif</span>(<span class="dv">2</span>))</span>
<span id="cb37-260"><a href="#cb37-260"></a></span>
<span id="cb37-261"><a href="#cb37-261"></a><span class="co"># data.frame</span></span>
<span id="cb37-262"><a href="#cb37-262"></a><span class="fu">lapply</span>(mtcars, mean) </span>
<span id="cb37-263"><a href="#cb37-263"></a><span class="fu">apply</span>(mtcars, <span class="dv">2</span>, mean)</span>
<span id="cb37-264"><a href="#cb37-264"></a><span class="fu">apply</span>(mtcars, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb37-265"><a href="#cb37-265"></a><span class="in">```</span></span>
<span id="cb37-266"><a href="#cb37-266"></a></span>
<span id="cb37-267"><a href="#cb37-267"></a><span class="fu">### purrr</span></span>
<span id="cb37-268"><a href="#cb37-268"></a></span>
<span id="cb37-269"><a href="#cb37-269"></a><span class="in">``` r</span></span>
<span id="cb37-270"><a href="#cb37-270"></a><span class="co"># vector operation</span></span>
<span id="cb37-271"><a href="#cb37-271"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="cf">function</span>(x) x <span class="sc">*</span> <span class="dv">2</span>) </span>
<span id="cb37-272"><a href="#cb37-272"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">2</span>)) <span class="co"># all purrr functions translate formulas into function</span></span>
<span id="cb37-273"><a href="#cb37-273"></a></span>
<span id="cb37-274"><a href="#cb37-274"></a><span class="co"># data.frame</span></span>
<span id="cb37-275"><a href="#cb37-275"></a><span class="fu">map</span>(mtcars, mean) </span>
<span id="cb37-276"><a href="#cb37-276"></a><span class="fu">map_dbl</span>(mtcars, mean)</span>
<span id="cb37-277"><a href="#cb37-277"></a><span class="fu">map_dbl</span>(mtcars, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb37-278"><a href="#cb37-278"></a><span class="fu">map_dbl</span>(mtcars, <span class="sc">~</span> <span class="fu">length</span>(<span class="fu">unique</span>(.x)))</span>
<span id="cb37-279"><a href="#cb37-279"></a><span class="in">```</span></span>
<span id="cb37-280"><a href="#cb37-280"></a></span>
<span id="cb37-281"><a href="#cb37-281"></a>:::</span>
<span id="cb37-282"><a href="#cb37-282"></a></span>
<span id="cb37-283"><a href="#cb37-283"></a>::: callout-warning</span>
<span id="cb37-284"><a href="#cb37-284"></a>One needs to know the expected output type. It's often useful to switch back to <span class="in">`map()`</span>, because it can accept any type of output.</span>
<span id="cb37-285"><a href="#cb37-285"></a>:::</span>
<span id="cb37-286"><a href="#cb37-286"></a></span>
<span id="cb37-287"><a href="#cb37-287"></a><span class="fu">## Extractions</span></span>
<span id="cb37-288"><a href="#cb37-288"></a></span>
<span id="cb37-289"><a href="#cb37-289"></a>The map functions have shortcuts for extracting elements from a vector, powered by <span class="in">`purrr::pluck()`</span>. You can use</span>
<span id="cb37-290"><a href="#cb37-290"></a></span>
<span id="cb37-291"><a href="#cb37-291"></a><span class="ss">-   </span>a character vector to select elements by name</span>
<span id="cb37-292"><a href="#cb37-292"></a><span class="ss">-   </span>an integer vector to select by position or</span>
<span id="cb37-293"><a href="#cb37-293"></a><span class="ss">-   </span>a list to select by both name and position.</span>
<span id="cb37-294"><a href="#cb37-294"></a></span>
<span id="cb37-295"><a href="#cb37-295"></a><span class="in">``` r</span></span>
<span id="cb37-296"><a href="#cb37-296"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-297"><a href="#cb37-297"></a>  <span class="fu">list</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>), <span class="at">z =</span> <span class="st">"a"</span>),</span>
<span id="cb37-298"><a href="#cb37-298"></a>  <span class="fu">list</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="at">z =</span> <span class="st">"b"</span>),</span>
<span id="cb37-299"><a href="#cb37-299"></a>  <span class="fu">list</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)))</span>
<span id="cb37-300"><a href="#cb37-300"></a>x</span>
<span id="cb37-301"><a href="#cb37-301"></a><span class="in">```</span></span>
<span id="cb37-302"><a href="#cb37-302"></a></span>
<span id="cb37-303"><a href="#cb37-303"></a>::: panel-tabset</span>
<span id="cb37-304"><a href="#cb37-304"></a></span>
<span id="cb37-305"><a href="#cb37-305"></a><span class="fu">### base</span></span>
<span id="cb37-306"><a href="#cb37-306"></a></span>
<span id="cb37-307"><a href="#cb37-307"></a><span class="in">``` r</span></span>
<span id="cb37-308"><a href="#cb37-308"></a><span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="st">"x"</span>]))) <span class="co"># select by name</span></span>
<span id="cb37-309"><a href="#cb37-309"></a><span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="dv">1</span>]))) <span class="co"># select by position</span></span>
<span id="cb37-310"><a href="#cb37-310"></a><span class="fu">as.numeric</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="st">"y"</span>][[<span class="dv">1</span>]][<span class="dv">1</span>])) <span class="co"># select by both</span></span>
<span id="cb37-311"><a href="#cb37-311"></a><span class="fu">as.character</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(x, <span class="cf">function</span>(e) e[<span class="st">"z"</span>])))</span>
<span id="cb37-312"><a href="#cb37-312"></a><span class="in">```</span></span>
<span id="cb37-313"><a href="#cb37-313"></a></span>
<span id="cb37-314"><a href="#cb37-314"></a><span class="fu">### purrr</span></span>
<span id="cb37-315"><a href="#cb37-315"></a></span>
<span id="cb37-316"><a href="#cb37-316"></a><span class="in">``` r</span></span>
<span id="cb37-317"><a href="#cb37-317"></a><span class="fu">map_dbl</span>(x, <span class="st">"x"</span>) <span class="co"># select by name</span></span>
<span id="cb37-318"><a href="#cb37-318"></a><span class="fu">map_dbl</span>(x, <span class="dv">1</span>) <span class="co"># select by position</span></span>
<span id="cb37-319"><a href="#cb37-319"></a><span class="fu">map_dbl</span>(x, <span class="fu">list</span>(<span class="st">"y"</span>, <span class="dv">1</span>)) <span class="co"># select by both</span></span>
<span id="cb37-320"><a href="#cb37-320"></a><span class="fu">map_chr</span>(x, <span class="st">"z"</span>) <span class="co"># error if a component doesn't exist</span></span>
<span id="cb37-321"><a href="#cb37-321"></a><span class="fu">map_chr</span>(x, <span class="st">"z"</span>, <span class="at">.default =</span> <span class="cn">NA</span>)</span>
<span id="cb37-322"><a href="#cb37-322"></a><span class="fu">unlist</span>(<span class="fu">map</span>(x, <span class="st">"z"</span>)) <span class="co"># the safer way</span></span>
<span id="cb37-323"><a href="#cb37-323"></a><span class="in">```</span></span>
<span id="cb37-324"><a href="#cb37-324"></a></span>
<span id="cb37-325"><a href="#cb37-325"></a>:::</span>
<span id="cb37-326"><a href="#cb37-326"></a></span>
<span id="cb37-327"><a href="#cb37-327"></a><span class="fu">## Passing arguments</span></span>
<span id="cb37-328"><a href="#cb37-328"></a></span>
<span id="cb37-329"><a href="#cb37-329"></a>It's often required to pass additional arguments to the function that is called.</span>
<span id="cb37-330"><a href="#cb37-330"></a></span>
<span id="cb37-331"><a href="#cb37-331"></a><span class="in">``` r</span></span>
<span id="cb37-332"><a href="#cb37-332"></a>(x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>))</span>
<span id="cb37-333"><a href="#cb37-333"></a><span class="fu">map_dbl</span>(x, <span class="sc">~</span> <span class="fu">mean</span>(.x)) <span class="co"># NA</span></span>
<span id="cb37-334"><a href="#cb37-334"></a><span class="fu">map_dbl</span>(x, <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-335"><a href="#cb37-335"></a><span class="fu">map_dbl</span>(x, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># simpler form</span></span>
<span id="cb37-336"><a href="#cb37-336"></a><span class="st">```</span></span>
<span id="cb37-337"><a href="#cb37-337"></a></span>
<span id="cb37-338"><a href="#cb37-338"></a><span class="at">::: column-margin</span></span>
<span id="cb37-339"><a href="#cb37-339"></a><span class="at">&gt; Any arguments that come after </span><span class="st">`</span>f<span class="st">`</span><span class="at"> in the call are inserted ***after*** the data in individual calls to </span><span class="st">`</span><span class="fu">f</span>()<span class="st">`</span><span class="at">. Check @fig-maparg. Note that these arguments are only vectorised over its first argument. If an argument after </span><span class="st">`</span>f<span class="st">`</span><span class="at"> is a vector, it will be passed along as is @fig-maplist.</span></span>
<span id="cb37-340"><a href="#cb37-340"></a><span class="at">:::</span></span>
<span id="cb37-341"><a href="#cb37-341"></a></span>
<span id="cb37-342"><a href="#cb37-342"></a><span class="at">::: callout-important</span></span>
<span id="cb37-343"><a href="#cb37-343"></a><span class="at">It is recommended writing out the full argument names, as it makes it easier to read.</span></span>
<span id="cb37-344"><a href="#cb37-344"></a><span class="at">:::</span></span>
<span id="cb37-345"><a href="#cb37-345"></a></span>
<span id="cb37-346"><a href="#cb37-346"></a><span class="at">So far the first argument to </span><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at"> has always been the first argument. Imagine a scenario where the first argument should be constant, and a second argument is varying. Refer @fig-mapargflipped. For example let's say we have a vector that contains a few unusual values, and we want to explore the effect of different amounts of trimming when computing the mean.</span></span>
<span id="cb37-347"><a href="#cb37-347"></a></span>
<span id="cb37-348"><a href="#cb37-348"></a><span class="at">::: column-margin</span></span>
<span id="cb37-349"><a href="#cb37-349"></a><span class="at">![Varying a second argument](diagrams/map-arg-flipped.png){#fig-mapargflipped}</span></span>
<span id="cb37-350"><a href="#cb37-350"></a><span class="at">:::</span></span>
<span id="cb37-351"><a href="#cb37-351"></a></span>
<span id="cb37-352"><a href="#cb37-352"></a><span class="st">```</span> r</span>
<span id="cb37-353"><a href="#cb37-353"></a>trims <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)</span>
<span id="cb37-354"><a href="#cb37-354"></a>x <span class="ot">&lt;-</span> <span class="fu">rcauchy</span>(<span class="dv">1000</span>) <span class="co"># Cauchy Distribution</span></span>
<span id="cb37-355"><a href="#cb37-355"></a><span class="fu">map_dbl</span>(trims, <span class="sc">~</span> <span class="fu">mean</span>(x, <span class="at">trim =</span> .x))</span>
<span id="cb37-356"><a href="#cb37-356"></a><span class="fu">map_dbl</span>(trims, <span class="cf">function</span>(t) <span class="fu">mean</span>(x, <span class="at">trim =</span> t))</span>
<span id="cb37-357"><a href="#cb37-357"></a><span class="st">```</span></span>
<span id="cb37-358"><a href="#cb37-358"></a></span>
<span id="cb37-359"><a href="#cb37-359"></a><span class="at">## Excercise</span></span>
<span id="cb37-360"><a href="#cb37-360"></a></span>
<span id="cb37-361"><a href="#cb37-361"></a><span class="at">Let's use </span><span class="st">`</span>purrr<span class="st">`</span><span class="at"> functions to solve a moderately realistic problem. We will fit a model using </span><span class="st">`</span>iris<span class="st">`</span><span class="at"> to each subgroup </span><span class="st">`</span>Species<span class="st">`</span><span class="at"> and extract the </span><span class="st">`</span>R2<span class="st">`</span><span class="at"> &amp; </span><span class="st">`</span>SE<span class="st">`</span><span class="at"> from each model.</span></span>
<span id="cb37-362"><a href="#cb37-362"></a></span>
<span id="cb37-363"><a href="#cb37-363"></a><span class="at">Steps performed: </span></span>
<span id="cb37-364"><a href="#cb37-364"></a></span>
<span id="cb37-365"><a href="#cb37-365"></a><span class="at">1. Split </span><span class="st">`</span>iris<span class="st">`</span><span class="at"> by </span><span class="st">`</span>Species<span class="st">`</span><span class="at"> - creates a list of 4 </span><span class="st">`</span>data.frames<span class="st">`</span></span>
<span id="cb37-366"><a href="#cb37-366"></a><span class="at">2. Fit a linear model for each data split with the formula: </span><span class="st">`</span>Sepal.Length <span class="sc">~</span> Sepal.Length <span class="sc">+</span> Sepal.Width <span class="sc">+</span> Petal.Length <span class="sc">+</span> Petal.Width<span class="st">`</span></span>
<span id="cb37-367"><a href="#cb37-367"></a><span class="at">3. Extract performance metrics from each model as mentioned above.</span></span>
<span id="cb37-368"><a href="#cb37-368"></a><span class="at">4. Round the results up to 2 decimal place.</span></span>
<span id="cb37-369"><a href="#cb37-369"></a><span class="at">5. Combine the results into one table for comparison.</span></span>
<span id="cb37-370"><a href="#cb37-370"></a></span>
<span id="cb37-371"><a href="#cb37-371"></a><span class="at">::: panel-tabset</span></span>
<span id="cb37-372"><a href="#cb37-372"></a></span>
<span id="cb37-373"><a href="#cb37-373"></a><span class="at">#### base</span></span>
<span id="cb37-374"><a href="#cb37-374"></a></span>
<span id="cb37-375"><a href="#cb37-375"></a><span class="st">```</span>{r, message<span class="ot">=</span><span class="cn">FALSE</span>}</span>
<span id="cb37-376"><a href="#cb37-376"></a><span class="co">#| label: tbl-modelperfbase</span></span>
<span id="cb37-377"><a href="#cb37-377"></a><span class="co">#| tbl-cap: model performance</span></span>
<span id="cb37-378"><a href="#cb37-378"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-379"><a href="#cb37-379"></a><span class="co">#| column: margin</span></span>
<span id="cb37-380"><a href="#cb37-380"></a></span>
<span id="cb37-381"><a href="#cb37-381"></a><span class="co"># data and model calibration</span></span>
<span id="cb37-382"><a href="#cb37-382"></a>dd_list <span class="ot">&lt;-</span> <span class="fu">split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris<span class="sc">$</span>Species)</span>
<span id="cb37-383"><a href="#cb37-383"></a>setosa <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> dd_list[[<span class="st">"setosa"</span>]]))</span>
<span id="cb37-384"><a href="#cb37-384"></a>versicolor <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> dd_list[[<span class="st">"versicolor"</span>]]))</span>
<span id="cb37-385"><a href="#cb37-385"></a>virginica <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> dd_list[[<span class="st">"virginica"</span>]]))</span>
<span id="cb37-386"><a href="#cb37-386"></a></span>
<span id="cb37-387"><a href="#cb37-387"></a><span class="co"># preparing final output as desired</span></span>
<span id="cb37-388"><a href="#cb37-388"></a>models <span class="ot">&lt;-</span> <span class="fu">rbind.data.frame</span>(</span>
<span id="cb37-389"><a href="#cb37-389"></a>  <span class="fu">cbind.data.frame</span>(</span>
<span id="cb37-390"><a href="#cb37-390"></a>    <span class="at">model =</span> <span class="st">"setosa"</span>,</span>
<span id="cb37-391"><a href="#cb37-391"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(setosa)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]],</span>
<span id="cb37-392"><a href="#cb37-392"></a>    <span class="at">se =</span> setosa[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> setosa[[<span class="st">"r.squared"</span>]],</span>
<span id="cb37-393"><a href="#cb37-393"></a>    <span class="at">R2adj =</span> setosa[[<span class="st">"adj.r.squared"</span>]]),</span>
<span id="cb37-394"><a href="#cb37-394"></a>  <span class="fu">cbind.data.frame</span>(</span>
<span id="cb37-395"><a href="#cb37-395"></a>    <span class="at">model =</span> <span class="st">"versicolor"</span>, </span>
<span id="cb37-396"><a href="#cb37-396"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(versicolor)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]],</span>
<span id="cb37-397"><a href="#cb37-397"></a>    <span class="at">se =</span> versicolor[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> versicolor[[<span class="st">"r.squared"</span>]],</span>
<span id="cb37-398"><a href="#cb37-398"></a>    <span class="at">R2adj =</span> versicolor[[<span class="st">"adj.r.squared"</span>]]),</span>
<span id="cb37-399"><a href="#cb37-399"></a>  <span class="fu">cbind.data.frame</span>(</span>
<span id="cb37-400"><a href="#cb37-400"></a>    <span class="at">model =</span> <span class="st">"virginica"</span>, </span>
<span id="cb37-401"><a href="#cb37-401"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(virginica)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]],</span>
<span id="cb37-402"><a href="#cb37-402"></a>    <span class="at">se =</span> virginica[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> virginica[[<span class="st">"r.squared"</span>]],</span>
<span id="cb37-403"><a href="#cb37-403"></a>    <span class="at">R2adj =</span> virginica[[<span class="st">"adj.r.squared"</span>]]))</span>
<span id="cb37-404"><a href="#cb37-404"></a></span>
<span id="cb37-405"><a href="#cb37-405"></a><span class="co"># some cosmetics </span></span>
<span id="cb37-406"><a href="#cb37-406"></a>models<span class="sc">$</span>intercept <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>intercept, <span class="dv">2</span>)</span>
<span id="cb37-407"><a href="#cb37-407"></a>models<span class="sc">$</span>se <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>se, <span class="dv">2</span>)</span>
<span id="cb37-408"><a href="#cb37-408"></a>models<span class="sc">$</span>R2 <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>R2, <span class="dv">2</span>)</span>
<span id="cb37-409"><a href="#cb37-409"></a>models<span class="sc">$</span>R2adj <span class="ot">&lt;-</span> <span class="fu">round</span>(models<span class="sc">$</span>R2adj, <span class="dv">2</span>)</span>
<span id="cb37-410"><a href="#cb37-410"></a>models</span>
<span id="cb37-411"><a href="#cb37-411"></a><span class="st">```</span></span>
<span id="cb37-412"><a href="#cb37-412"></a></span>
<span id="cb37-413"><a href="#cb37-413"></a><span class="at">#### lapply</span></span>
<span id="cb37-414"><a href="#cb37-414"></a></span>
<span id="cb37-415"><a href="#cb37-415"></a><span class="st">```</span>{r, message<span class="ot">=</span><span class="cn">FALSE</span>}</span>
<span id="cb37-416"><a href="#cb37-416"></a><span class="co">#| label: tbl-modelperflapply</span></span>
<span id="cb37-417"><a href="#cb37-417"></a><span class="co">#| tbl-cap: model performance</span></span>
<span id="cb37-418"><a href="#cb37-418"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-419"><a href="#cb37-419"></a><span class="co">#| column: margin</span></span>
<span id="cb37-420"><a href="#cb37-420"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb37-421"><a href="#cb37-421"></a></span>
<span id="cb37-422"><a href="#cb37-422"></a><span class="fu">split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris<span class="sc">$</span>Species) <span class="sc">%&gt;%</span></span>
<span id="cb37-423"><a href="#cb37-423"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> x)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-424"><a href="#cb37-424"></a>  <span class="fu">lapply</span>(summary) <span class="sc">%&gt;%</span> </span>
<span id="cb37-425"><a href="#cb37-425"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(x)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]], </span>
<span id="cb37-426"><a href="#cb37-426"></a>                       <span class="at">se =</span> x[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> x[[<span class="st">"r.squared"</span>]], </span>
<span id="cb37-427"><a href="#cb37-427"></a>                       <span class="at">R2adj =</span> x[[<span class="st">"adj.r.squared"</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb37-428"><a href="#cb37-428"></a>  <span class="fu">lapply</span>(round, <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-429"><a href="#cb37-429"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"model"</span>) </span>
<span id="cb37-430"><a href="#cb37-430"></a><span class="st">```</span></span>
<span id="cb37-431"><a href="#cb37-431"></a></span>
<span id="cb37-432"><a href="#cb37-432"></a><span class="at">#### purrr</span></span>
<span id="cb37-433"><a href="#cb37-433"></a></span>
<span id="cb37-434"><a href="#cb37-434"></a><span class="st">```</span>{r, message<span class="ot">=</span><span class="cn">FALSE</span>}</span>
<span id="cb37-435"><a href="#cb37-435"></a><span class="co">#| label: tbl-modelperfpurrr</span></span>
<span id="cb37-436"><a href="#cb37-436"></a><span class="co">#| tbl-cap: model performance</span></span>
<span id="cb37-437"><a href="#cb37-437"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-438"><a href="#cb37-438"></a><span class="co">#| column: margin</span></span>
<span id="cb37-439"><a href="#cb37-439"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb37-440"><a href="#cb37-440"></a><span class="fu">library</span>(purrr)</span>
<span id="cb37-441"><a href="#cb37-441"></a></span>
<span id="cb37-442"><a href="#cb37-442"></a><span class="fu">split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris<span class="sc">$</span>Species) <span class="sc">%&gt;%</span> </span>
<span id="cb37-443"><a href="#cb37-443"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> ., <span class="at">data =</span> .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-444"><a href="#cb37-444"></a>  <span class="fu">map</span>(summary) <span class="sc">%&gt;%</span> </span>
<span id="cb37-445"><a href="#cb37-445"></a>  <span class="fu">map</span>(<span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(x)[[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]], </span>
<span id="cb37-446"><a href="#cb37-446"></a>                    <span class="at">se =</span> x[[<span class="st">"sigma"</span>]], <span class="at">R2 =</span> x[[<span class="st">"r.squared"</span>]], </span>
<span id="cb37-447"><a href="#cb37-447"></a>                    <span class="at">R2adj =</span> x[[<span class="st">"adj.r.squared"</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb37-448"><a href="#cb37-448"></a>  <span class="fu">map</span>(round, <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-449"><a href="#cb37-449"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"model"</span>) </span>
<span id="cb37-450"><a href="#cb37-450"></a><span class="st">```</span></span>
<span id="cb37-451"><a href="#cb37-451"></a></span>
<span id="cb37-452"><a href="#cb37-452"></a><span class="at">:::</span></span>
<span id="cb37-453"><a href="#cb37-453"></a></span>
<span id="cb37-454"><a href="#cb37-454"></a><span class="at">## Map family</span></span>
<span id="cb37-455"><a href="#cb37-455"></a></span>
<span id="cb37-456"><a href="#cb37-456"></a><span class="at">There are 23 primary variants of </span><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at"> but fortunately, by design of </span><span class="st">`</span>purrr<span class="st">`</span><span class="at"> we only need to learn five new ideas:</span></span>
<span id="cb37-457"><a href="#cb37-457"></a></span>
<span id="cb37-458"><a href="#cb37-458"></a><span class="at">-   </span><span class="st">`</span><span class="fu">modify</span>()<span class="st">`</span><span class="at">: Returns same type as input</span></span>
<span id="cb37-459"><a href="#cb37-459"></a><span class="at">-   </span><span class="st">`</span><span class="fu">map2</span>()<span class="st">`</span><span class="at">: Iterate over two inputs</span></span>
<span id="cb37-460"><a href="#cb37-460"></a><span class="at">-   </span><span class="st">`</span><span class="fu">imap</span>()<span class="st">`</span><span class="at">: Iterate with an index.</span></span>
<span id="cb37-461"><a href="#cb37-461"></a><span class="at">-   </span><span class="st">`</span><span class="fu">walk</span>()<span class="st">`</span><span class="at">: Return nothing</span></span>
<span id="cb37-462"><a href="#cb37-462"></a><span class="at">-   </span><span class="st">`</span><span class="fu">pmap</span>()<span class="st">`</span><span class="at">: Iterate over any number of inputs</span></span>
<span id="cb37-463"><a href="#cb37-463"></a></span>
<span id="cb37-464"><a href="#cb37-464"></a><span class="at">::: column-margin</span></span>
<span id="cb37-465"><a href="#cb37-465"></a><span class="at">| arguments | list     | same_type   | nothing   |</span></span>
<span id="cb37-466"><a href="#cb37-466"></a><span class="at">|-----------|----------|-------------|-----------|</span></span>
<span id="cb37-467"><a href="#cb37-467"></a><span class="at">| 1         | </span><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at">  | </span><span class="st">`</span><span class="fu">modify</span>()<span class="st">`</span><span class="at">  | </span><span class="st">`</span><span class="fu">walk</span>()<span class="st">`</span><span class="at">  |</span></span>
<span id="cb37-468"><a href="#cb37-468"></a><span class="at">| 2         | </span><span class="st">`</span><span class="fu">map2</span>()<span class="st">`</span><span class="at"> | </span><span class="st">`</span><span class="fu">modify2</span>()<span class="st">`</span><span class="at"> | </span><span class="st">`</span><span class="fu">walk2</span>()<span class="st">`</span><span class="at"> |</span></span>
<span id="cb37-469"><a href="#cb37-469"></a><span class="at">| 1 + index | </span><span class="st">`</span><span class="fu">imap</span>()<span class="st">`</span><span class="at"> | </span><span class="st">`</span><span class="fu">imodify</span>()<span class="st">`</span><span class="at"> | </span><span class="st">`</span><span class="fu">iwalk</span>()<span class="st">`</span><span class="at"> |</span></span>
<span id="cb37-470"><a href="#cb37-470"></a><span class="at">| N         | </span><span class="st">`</span><span class="fu">pmap</span>()<span class="st">`</span><span class="at"> | ---         | </span><span class="st">`</span><span class="fu">pwalk</span>()<span class="st">`</span><span class="at"> |</span></span>
<span id="cb37-471"><a href="#cb37-471"></a></span>
<span id="cb37-472"><a href="#cb37-472"></a><span class="at">: Relation between variants {#tbl-mapvariants}</span></span>
<span id="cb37-473"><a href="#cb37-473"></a><span class="at">:::</span></span>
<span id="cb37-474"><a href="#cb37-474"></a></span>
<span id="cb37-475"><a href="#cb37-475"></a><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at"> always returns a list. </span><span class="st">`</span><span class="fu">modify</span>()<span class="st">`</span><span class="at"> returns the same type of output as the input:</span></span>
<span id="cb37-476"><a href="#cb37-476"></a></span>
<span id="cb37-477"><a href="#cb37-477"></a><span class="st">```</span> r</span>
<span id="cb37-478"><a href="#cb37-478"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb37-479"><a href="#cb37-479"></a></span>
<span id="cb37-480"><a href="#cb37-480"></a><span class="fu">map</span>(dd, <span class="sc">~</span> .x <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># list</span></span>
<span id="cb37-481"><a href="#cb37-481"></a><span class="fu">modify</span>(dd, <span class="sc">~</span> .x <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># data.frame</span></span>
<span id="cb37-482"><a href="#cb37-482"></a><span class="st">```</span></span>
<span id="cb37-483"><a href="#cb37-483"></a></span>
<span id="cb37-484"><a href="#cb37-484"></a><span class="st">`</span><span class="fu">modify</span>()<span class="st">`</span><span class="at"> has a very useful variant of called </span><span class="st">`</span><span class="fu">modify_if</span>()<span class="st">`</span><span class="at"> which allows you to (e.g.) only double *numeric* columns of a data frame with </span><span class="st">`</span><span class="fu">modify_if</span>(dd, is.numeric, <span class="sc">~</span> .x <span class="sc">*</span> <span class="dv">2</span>)<span class="st">`</span><span class="at">.</span></span>
<span id="cb37-485"><a href="#cb37-485"></a></span>
<span id="cb37-486"><a href="#cb37-486"></a><span class="st">```</span> r</span>
<span id="cb37-487"><a href="#cb37-487"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>), </span>
<span id="cb37-488"><a href="#cb37-488"></a>                 <span class="at">z =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-489"><a href="#cb37-489"></a><span class="fu">map_if</span>(dd, is.numeric, mean)</span>
<span id="cb37-490"><a href="#cb37-490"></a><span class="fu">modify_if</span>(dd, is.numeric, mean)</span>
<span id="cb37-491"><a href="#cb37-491"></a><span class="st">```</span></span>
<span id="cb37-492"><a href="#cb37-492"></a></span>
<span id="cb37-493"><a href="#cb37-493"></a><span class="at">::: callout-note</span></span>
<span id="cb37-494"><a href="#cb37-494"></a><span class="st">`</span><span class="fu">modify</span>()<span class="st">`</span><span class="at"> doesn't modify in place, it returns a modified copy, to make it permanent modify one needs to assign it.</span></span>
<span id="cb37-495"><a href="#cb37-495"></a><span class="at">:::</span></span>
<span id="cb37-496"><a href="#cb37-496"></a></span>
<span id="cb37-497"><a href="#cb37-497"></a><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at"> is vectorised over a single argument, </span><span class="st">`</span>.x<span class="st">`</span><span class="at"> thus making it poorly suited for some problems. For example, to find a weighted mean when you have a list of observations and a list of weights we need a new tool: a </span><span class="st">`</span><span class="fu">map2</span>()<span class="st">`</span><span class="at">, which is vectorised over two arguments.</span></span>
<span id="cb37-498"><a href="#cb37-498"></a></span>
<span id="cb37-499"><a href="#cb37-499"></a><span class="at">::: column-margin</span></span>
<span id="cb37-500"><a href="#cb37-500"></a><span class="at">![map2](diagrams/map2.png){#fig-map2}</span></span>
<span id="cb37-501"><a href="#cb37-501"></a><span class="at">:::</span></span>
<span id="cb37-502"><a href="#cb37-502"></a></span>
<span id="cb37-503"><a href="#cb37-503"></a><span class="st">```</span> r</span>
<span id="cb37-504"><a href="#cb37-504"></a>x <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">10</span>)) <span class="co"># uniform random numbers</span></span>
<span id="cb37-505"><a href="#cb37-505"></a>w <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="sc">~</span> <span class="fu">rpois</span>(<span class="dv">10</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="dv">1</span>) <span class="co"># poisson random numbers</span></span>
<span id="cb37-506"><a href="#cb37-506"></a><span class="fu">map_dbl</span>(x, weighted.mean, <span class="at">w =</span> w) <span class="co"># error</span></span>
<span id="cb37-507"><a href="#cb37-507"></a><span class="fu">map2_dbl</span>(x, w, weighted.mean) <span class="co"># desired output</span></span>
<span id="cb37-508"><a href="#cb37-508"></a><span class="st">```</span></span>
<span id="cb37-509"><a href="#cb37-509"></a></span>
<span id="cb37-510"><a href="#cb37-510"></a><span class="at">The implementation of </span><span class="st">`</span><span class="fu">map2</span>()<span class="st">`</span><span class="at"> is quite similar to </span><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at">, here instead of iterating over one vector, it iterate over two in parallel. One of the big differences between </span><span class="st">`</span><span class="fu">map2</span>()<span class="st">`</span><span class="at"> &amp; </span><span class="st">`</span><span class="fu">map2</span>()<span class="st">`</span><span class="at"> is that it recycles its inputs to make sure that they're the same length.</span></span>
<span id="cb37-511"><a href="#cb37-511"></a></span>
<span id="cb37-512"><a href="#cb37-512"></a><span class="at">::: callout-tip</span></span>
<span id="cb37-513"><a href="#cb37-513"></a><span class="st">`</span>purrr<span class="st">`</span><span class="at"> provides the walk family of functions that ignore the return values of the </span><span class="st">`</span>.f<span class="st">`</span><span class="at"> and instead return </span><span class="st">`</span>.x<span class="st">`</span><span class="at"> invisibly</span></span>
<span id="cb37-514"><a href="#cb37-514"></a><span class="at">:::</span></span>
<span id="cb37-515"><a href="#cb37-515"></a></span>
<span id="cb37-516"><a href="#cb37-516"></a><span class="st">`</span><span class="fu">imap</span>()<span class="st">`</span><span class="at"> family is analogous to the to the loop over form </span><span class="st">`</span><span class="fu">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x))<span class="st">`</span><span class="at"> &amp; </span><span class="st">`</span><span class="fu">for</span> (nm <span class="cf">in</span> <span class="fu">names</span>(x))<span class="st">`</span><span class="at">. This allows you to iterate over the values and the indices of a vector in parallel.</span></span>
<span id="cb37-517"><a href="#cb37-517"></a></span>
<span id="cb37-518"><a href="#cb37-518"></a><span class="st">```</span> r</span>
<span id="cb37-519"><a href="#cb37-519"></a>x <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="sc">~</span> <span class="fu">sample</span>(<span class="dv">1000</span>, <span class="dv">10</span>))</span>
<span id="cb37-520"><a href="#cb37-520"></a><span class="fu">imap_chr</span>(x, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"The highest value of "</span>, .y, <span class="st">" is "</span>, <span class="fu">max</span>(.x)))</span>
<span id="cb37-521"><a href="#cb37-521"></a><span class="st">```</span></span>
<span id="cb37-522"><a href="#cb37-522"></a></span>
<span id="cb37-523"><a href="#cb37-523"></a><span class="at">::: callout-tip</span></span>
<span id="cb37-524"><a href="#cb37-524"></a><span class="st">`</span><span class="fu">imap</span>()<span class="st">`</span><span class="at"> is useful if you want to work with the values in a vector along with their positions.</span></span>
<span id="cb37-525"><a href="#cb37-525"></a><span class="at">:::</span></span>
<span id="cb37-526"><a href="#cb37-526"></a></span>
<span id="cb37-527"><a href="#cb37-527"></a><span class="at">Since we have </span><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at"> and </span><span class="st">`</span><span class="fu">map2</span>()<span class="st">`</span><span class="at">, one might expect </span><span class="st">`</span><span class="fu">map3</span>()<span class="st">`</span><span class="at">, </span><span class="st">`</span><span class="fu">map4</span>()<span class="st">`</span><span class="at">, </span><span class="st">`</span><span class="fu">map5</span>()<span class="st">`</span><span class="at">, instead </span><span class="st">`</span>purrr<span class="st">`</span><span class="at"> takes a slightly different tack with </span><span class="st">`</span><span class="fu">pmap</span>()<span class="st">`</span><span class="at">: you supply it a single list, which contains any number of arguments. In most cases, that will be a list of equal-length vectors, similar to </span><span class="st">`</span>data.frame<span class="st">`</span><span class="at">.</span></span>
<span id="cb37-528"><a href="#cb37-528"></a></span>
<span id="cb37-529"><a href="#cb37-529"></a><span class="at">::: column-margin</span></span>
<span id="cb37-530"><a href="#cb37-530"></a><span class="at">![pmap](diagrams/pmap.png){#fig-pmap}</span></span>
<span id="cb37-531"><a href="#cb37-531"></a><span class="at">:::</span></span>
<span id="cb37-532"><a href="#cb37-532"></a></span>
<span id="cb37-533"><a href="#cb37-533"></a><span class="at">::: {.callout-note title="Example"}</span></span>
<span id="cb37-534"><a href="#cb37-534"></a><span class="st">`</span><span class="fu">map2</span>(x, y, f)<span class="st">`</span><span class="at"> is equivalent to </span><span class="st">`</span><span class="fu">pmap</span>(<span class="fu">list</span>(x, y), f)<span class="st">`</span><span class="at"> </span><span class="st">`</span><span class="fu">map2_dbl</span>(x, w, weighted.mean)<span class="st">`</span><span class="at"> is equivalent to </span><span class="st">`</span><span class="fu">pmap_dbl</span>(<span class="fu">list</span>(x, w), weighted.mean)<span class="st">`</span></span>
<span id="cb37-535"><a href="#cb37-535"></a><span class="at">:::</span></span>
<span id="cb37-536"><a href="#cb37-536"></a></span>
<span id="cb37-537"><a href="#cb37-537"></a><span class="at">A big difference between </span><span class="st">`</span><span class="fu">pmap</span>()<span class="st">`</span><span class="at"> and the is that </span><span class="st">`</span><span class="fu">pmap</span>()<span class="st">`</span><span class="at"> gives you much finer control over argument matching over other map functions because one can name the components of the list.I It's always a good practice to name the components of the list to make it very clear how the function will be called.</span></span>
<span id="cb37-538"><a href="#cb37-538"></a></span>
<span id="cb37-539"><a href="#cb37-539"></a><span class="at">::: column-margin</span></span>
<span id="cb37-540"><a href="#cb37-540"></a><span class="at">![pmap with arguments](diagrams/pmap-3.png){#fig-pmapargs}</span></span>
<span id="cb37-541"><a href="#cb37-541"></a><span class="at">:::</span></span>
<span id="cb37-542"><a href="#cb37-542"></a></span>
<span id="cb37-543"><a href="#cb37-543"></a><span class="st">```</span> r</span>
<span id="cb37-544"><a href="#cb37-544"></a>params <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb37-545"><a href="#cb37-545"></a>  <span class="sc">~</span> n, <span class="sc">~</span> min, <span class="sc">~</span> max,</span>
<span id="cb37-546"><a href="#cb37-546"></a>   1L,     <span class="dv">0</span>,     <span class="dv">1</span>,</span>
<span id="cb37-547"><a href="#cb37-547"></a>   2L,    <span class="dv">10</span>,   <span class="dv">100</span>,</span>
<span id="cb37-548"><a href="#cb37-548"></a>   3L,   <span class="dv">100</span>,  <span class="dv">1000</span>)</span>
<span id="cb37-549"><a href="#cb37-549"></a>   </span>
<span id="cb37-550"><a href="#cb37-550"></a><span class="fu">pmap</span>(params, runif)</span>
<span id="cb37-551"><a href="#cb37-551"></a><span class="st">```</span></span>
<span id="cb37-552"><a href="#cb37-552"></a></span>
<span id="cb37-553"><a href="#cb37-553"></a><span class="at">::: {.callout-warning title="Caution"}</span></span>
<span id="cb37-554"><a href="#cb37-554"></a><span class="at">Here, the column names are critical.</span></span>
<span id="cb37-555"><a href="#cb37-555"></a><span class="at">:::</span></span>
<span id="cb37-556"><a href="#cb37-556"></a></span>
<span id="cb37-557"><a href="#cb37-557"></a><span class="at">## Reduce family</span></span>
<span id="cb37-558"><a href="#cb37-558"></a></span>
<span id="cb37-559"><a href="#cb37-559"></a><span class="at">The next most important family of functions is the </span><span class="st">`</span>reduce<span class="st">`</span><span class="at"> family. This is smaller, with only two main variants &amp; is less commonly used, but it's a powerful idea. </span><span class="st">`</span><span class="fu">reduce</span>()<span class="st">`</span><span class="at"> takes a vector of length *n* and produces a vector of length *1* by calling a function with a pair of values at a time.</span></span>
<span id="cb37-560"><a href="#cb37-560"></a></span>
<span id="cb37-561"><a href="#cb37-561"></a><span class="at">::: column-margin</span></span>
<span id="cb37-562"><a href="#cb37-562"></a><span class="at">![reduce](diagrams/reduce.png){#fig-reduce}</span></span>
<span id="cb37-563"><a href="#cb37-563"></a><span class="at">:::</span></span>
<span id="cb37-564"><a href="#cb37-564"></a></span>
<span id="cb37-565"><a href="#cb37-565"></a><span class="at">::: {.callout-note title="Example"}</span></span>
<span id="cb37-566"><a href="#cb37-566"></a><span class="st">`</span><span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, f)<span class="st">`</span><span class="at"> is equivalent to </span><span class="st">`</span><span class="fu">f</span>(<span class="fu">f</span>(<span class="fu">f</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">3</span>), <span class="dv">4</span>)<span class="st">`</span><span class="at">.</span></span>
<span id="cb37-567"><a href="#cb37-567"></a><span class="at">:::</span></span>
<span id="cb37-568"><a href="#cb37-568"></a></span>
<span id="cb37-571"><a href="#cb37-571"></a><span class="in">```{r}</span></span>
<span id="cb37-572"><a href="#cb37-572"></a>x <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="at">replace =</span> T))</span>
<span id="cb37-573"><a href="#cb37-573"></a><span class="fu">str</span>(x)</span>
<span id="cb37-574"><a href="#cb37-574"></a><span class="st">```</span></span>
<span id="cb37-575"><a href="#cb37-575"></a></span>
<span id="cb37-576"><a href="#cb37-576"></a><span class="at">Let's find the common observations from the above list</span></span>
<span id="cb37-577"><a href="#cb37-577"></a></span>
<span id="cb37-578"><a href="#cb37-578"></a><span class="at">::: column-margin</span></span>
<span id="cb37-579"><a href="#cb37-579"></a><span class="at">The first </span><span class="st">`</span><span class="fu">reduce</span>()<span class="st">`</span><span class="at"> variant is </span><span class="st">`</span><span class="fu">accumulate</span>()<span class="st">`</span><span class="at"> which it returns all the intermediate results.</span></span>
<span id="cb37-580"><a href="#cb37-580"></a><span class="at">:::</span></span>
<span id="cb37-581"><a href="#cb37-581"></a></span>
<span id="cb37-582"><a href="#cb37-582"></a><span class="at">::: panel-tabset</span></span>
<span id="cb37-583"><a href="#cb37-583"></a></span>
<span id="cb37-584"><a href="#cb37-584"></a><span class="at">### copy-paste</span></span>
<span id="cb37-585"><a href="#cb37-585"></a></span>
<span id="cb37-588"><a href="#cb37-588"></a><span class="in">```{r}</span></span>
<span id="cb37-589"><a href="#cb37-589"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-590"><a href="#cb37-590"></a>out <span class="ot">&lt;-</span> x[[<span class="dv">1</span>]]</span>
<span id="cb37-591"><a href="#cb37-591"></a>out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[<span class="dv">2</span>]])</span>
<span id="cb37-592"><a href="#cb37-592"></a>out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[<span class="dv">3</span>]])</span>
<span id="cb37-593"><a href="#cb37-593"></a>out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[<span class="dv">4</span>]])</span>
<span id="cb37-594"><a href="#cb37-594"></a>out</span>
<span id="cb37-595"><a href="#cb37-595"></a><span class="st">```</span></span>
<span id="cb37-596"><a href="#cb37-596"></a></span>
<span id="cb37-597"><a href="#cb37-597"></a><span class="at">### loop</span></span>
<span id="cb37-598"><a href="#cb37-598"></a></span>
<span id="cb37-601"><a href="#cb37-601"></a><span class="in">```{r}</span></span>
<span id="cb37-602"><a href="#cb37-602"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-603"><a href="#cb37-603"></a>out <span class="ot">&lt;-</span> x[[<span class="dv">1</span>]]</span>
<span id="cb37-604"><a href="#cb37-604"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb37-605"><a href="#cb37-605"></a>  out <span class="ot">&lt;-</span> <span class="fu">intersect</span>(out, x[[i]])</span>
<span id="cb37-606"><a href="#cb37-606"></a>}</span>
<span id="cb37-607"><a href="#cb37-607"></a>out</span>
<span id="cb37-608"><a href="#cb37-608"></a><span class="st">```</span></span>
<span id="cb37-609"><a href="#cb37-609"></a></span>
<span id="cb37-610"><a href="#cb37-610"></a><span class="at">### reduce</span></span>
<span id="cb37-611"><a href="#cb37-611"></a></span>
<span id="cb37-614"><a href="#cb37-614"></a><span class="in">```{r}</span></span>
<span id="cb37-615"><a href="#cb37-615"></a><span class="co">#| code-fold: false</span></span>
<span id="cb37-616"><a href="#cb37-616"></a><span class="co"># accumulate(x, intersect)</span></span>
<span id="cb37-617"><a href="#cb37-617"></a><span class="fu">reduce</span>(x, intersect)</span>
<span id="cb37-618"><a href="#cb37-618"></a><span class="st">```</span></span>
<span id="cb37-619"><a href="#cb37-619"></a></span>
<span id="cb37-620"><a href="#cb37-620"></a><span class="at">:::</span></span>
<span id="cb37-621"><a href="#cb37-621"></a></span>
<span id="cb37-622"><a href="#cb37-622"></a><span class="at">::: column-margin</span></span>
<span id="cb37-623"><a href="#cb37-623"></a><span class="at">&gt; </span><span class="st">`</span>map<span class="sc">-</span>reduce<span class="st">`</span><span class="at"> (map combined with a reduce) is the idea that powers technology like </span><span class="st">`</span>Hadoop<span class="st">`</span><span class="at">. Now you can see how simple and powerful the underlying idea is. As a simple example, imagine computing the mean of a very large vector, so large that it has to be split over multiple computers. You could ask each computer to calculate the sum and the length, and then return those to the coordinator which computes the overall mean by dividing the total sum by the total length.</span></span>
<span id="cb37-624"><a href="#cb37-624"></a><span class="at">:::</span></span>
<span id="cb37-625"><a href="#cb37-625"></a></span>
<span id="cb37-626"><a href="#cb37-626"></a><span class="at">## Predicate functionals</span></span>
<span id="cb37-627"><a href="#cb37-627"></a></span>
<span id="cb37-628"><a href="#cb37-628"></a><span class="at">A **predicate** function returns a single </span><span class="st">`</span>TRUE<span class="st">`</span><span class="at"> or </span><span class="st">`</span>FALSE<span class="st">`</span><span class="at">, it returns </span><span class="st">`</span>TRUE<span class="st">`</span><span class="at"> when it **matches** a vector. It applies a predicate to each element of a vector. </span><span class="st">`</span>purrr<span class="st">`</span><span class="at"> provides seven useful functions which come in three groups:</span></span>
<span id="cb37-629"><a href="#cb37-629"></a></span>
<span id="cb37-630"><a href="#cb37-630"></a><span class="at">|     | function               | description                                 |</span></span>
<span id="cb37-631"><a href="#cb37-631"></a><span class="at">|-----|------------------------|---------------------------------------------|</span></span>
<span id="cb37-632"><a href="#cb37-632"></a><span class="at">| 1   | </span><span class="st">`</span><span class="fu">some</span>(.x, .p)<span class="st">`</span><span class="at">         | returns </span><span class="st">`</span>TRUE<span class="st">`</span><span class="at"> if **any** element matches   |</span></span>
<span id="cb37-633"><a href="#cb37-633"></a><span class="at">|     | </span><span class="st">`</span><span class="fu">every</span>(.x, .p)<span class="st">`</span><span class="at">        | returns </span><span class="st">`</span>TRUE<span class="st">`</span><span class="at"> if **all** element matches.  |</span></span>
<span id="cb37-634"><a href="#cb37-634"></a><span class="at">|     | </span><span class="st">`</span><span class="fu">none</span>(.x, .p)<span class="st">`</span><span class="at">         | returns </span><span class="st">`</span>TRUE<span class="st">`</span><span class="at"> if **no** element matches    |</span></span>
<span id="cb37-635"><a href="#cb37-635"></a><span class="at">| 2   | </span><span class="st">`</span><span class="fu">detect</span>(.x, .p)<span class="st">`</span><span class="at">       | returns the **value** of the first match    |</span></span>
<span id="cb37-636"><a href="#cb37-636"></a><span class="at">|     | </span><span class="st">`</span><span class="fu">detect_index</span>(.x, .p)<span class="st">`</span><span class="at"> | returns the **location** of the first match |</span></span>
<span id="cb37-637"><a href="#cb37-637"></a><span class="at">| 3   | </span><span class="st">`</span><span class="fu">keep</span>(.x, .p)<span class="st">`</span><span class="at">.        | **keeps** all matching elements             |</span></span>
<span id="cb37-638"><a href="#cb37-638"></a><span class="at">|     | </span><span class="st">`</span><span class="fu">discard</span>(.x, .p)<span class="st">`</span><span class="at">      | **drops** all matching elements             |</span></span>
<span id="cb37-639"><a href="#cb37-639"></a></span>
<span id="cb37-640"><a href="#cb37-640"></a><span class="st">```</span> r</span>
<span id="cb37-641"><a href="#cb37-641"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-642"><a href="#cb37-642"></a><span class="fu">detect</span>(dd, is.factor)</span>
<span id="cb37-643"><a href="#cb37-643"></a><span class="fu">detect_index</span>(dd, is.factor)</span>
<span id="cb37-644"><a href="#cb37-644"></a><span class="fu">keep</span>(dd, is.factor)</span>
<span id="cb37-645"><a href="#cb37-645"></a><span class="fu">discard</span>(dd, is.factor)</span>
<span id="cb37-646"><a href="#cb37-646"></a><span class="st">```</span></span>
<span id="cb37-647"><a href="#cb37-647"></a></span>
<span id="cb37-648"><a href="#cb37-648"></a><span class="at">::: callout-note</span></span>
<span id="cb37-649"><a href="#cb37-649"></a><span class="st">`</span><span class="fu">map</span>()<span class="st">`</span><span class="at"> and </span><span class="st">`</span><span class="fu">modify</span>()<span class="st">`</span><span class="at"> also can take predicate functions.</span></span>
<span id="cb37-650"><a href="#cb37-650"></a><span class="at">:::</span></span>
<span id="cb37-651"><a href="#cb37-651"></a></span>
<span id="cb37-652"><a href="#cb37-652"></a><span class="at"># Applications</span></span>
<span id="cb37-653"><a href="#cb37-653"></a></span>
<span id="cb37-654"><a href="#cb37-654"></a><span class="at">## MLE</span></span>
<span id="cb37-655"><a href="#cb37-655"></a></span>
<span id="cb37-656"><a href="#cb37-656"></a><span class="at">The goal of maximum likelihood estimation (MLE) is to find the parameter values for a distribution that make the observed data most likely. To do MLE, we start with a probability function. For example, let's take the Poisson distribution. If we know $\lambda$, we can compute the probability of getting a vector $\mathbf{x}$ of values ($x_1$, $x_2$, ..., $x_n$) by multiplying the Poisson probability function as follows:</span></span>
<span id="cb37-657"><a href="#cb37-657"></a></span>
<span id="cb37-658"><a href="#cb37-658"></a><span class="at">$$</span></span>
<span id="cb37-659"><a href="#cb37-659"></a><span class="at">P(\lambda, \mathbf{x}) = \prod_{i=1}^{n} </span><span class="sc">\f</span><span class="at">rac{\lambda ^ {x_i} e^{-\lambda}}{x_i!}</span></span>
<span id="cb37-660"><a href="#cb37-660"></a><span class="at">$$ Let's apply a </span><span class="st">`</span>log<span class="st">`</span><span class="at"> transformation to this probability function and simplify it as much as possible: $$</span></span>
<span id="cb37-661"><a href="#cb37-661"></a><span class="at">\log(P(\lambda, \mathbf{x})) = \log(\lambda) \sum_{i=1}^{n} x_i - n \lambda - \sum_{i=1}^{n} \log(x_i!) </span></span>
<span id="cb37-662"><a href="#cb37-662"></a><span class="at">$$</span></span>
<span id="cb37-663"><a href="#cb37-663"></a></span>
<span id="cb37-664"><a href="#cb37-664"></a><span class="at">We can now turn this function into an R function.</span></span>
<span id="cb37-665"><a href="#cb37-665"></a></span>
<span id="cb37-666"><a href="#cb37-666"></a><span class="st">```</span> r</span>
<span id="cb37-667"><a href="#cb37-667"></a><span class="co">#' log_likelihood</span></span>
<span id="cb37-668"><a href="#cb37-668"></a><span class="co">#' @param lambda shape parameter </span></span>
<span id="cb37-669"><a href="#cb37-669"></a><span class="co">#' @param x input vector</span></span>
<span id="cb37-670"><a href="#cb37-670"></a><span class="co">#' @return compute the (logged) probability</span></span>
<span id="cb37-671"><a href="#cb37-671"></a><span class="co">#' @example</span></span>
<span id="cb37-672"><a href="#cb37-672"></a><span class="co">#' log_likelihood(0.3, x = c(2, 1, 3, 0, 2))</span></span>
<span id="cb37-673"><a href="#cb37-673"></a><span class="co">#' </span></span>
<span id="cb37-674"><a href="#cb37-674"></a>log_likelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, x) {</span>
<span id="cb37-675"><a href="#cb37-675"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb37-676"><a href="#cb37-676"></a>  (<span class="fu">log</span>(lambda) <span class="sc">*</span> <span class="fu">sum</span>(x)) <span class="sc">-</span> (n <span class="sc">*</span> lambda) <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">lfactorial</span>(x))</span>
<span id="cb37-677"><a href="#cb37-677"></a>}</span>
<span id="cb37-678"><a href="#cb37-678"></a><span class="st">```</span></span>
<span id="cb37-679"><a href="#cb37-679"></a></span>
<span id="cb37-680"><a href="#cb37-680"></a><span class="at">::: column-margin</span></span>
<span id="cb37-681"><a href="#cb37-681"></a><span class="at">&gt; The R function is quite elegant because R is vectorised and, because it's a statistical programming language, R comes with built-in functions like the log-factorial (</span><span class="st">`</span><span class="fu">lfactorial</span>()<span class="st">`</span><span class="at">).</span></span>
<span id="cb37-682"><a href="#cb37-682"></a><span class="at">:::</span></span>
<span id="cb37-683"><a href="#cb37-683"></a></span>
<span id="cb37-684"><a href="#cb37-684"></a><span class="at">So far we've been thinking of </span><span class="st">`</span>lambda<span class="st">`</span><span class="at"> as fixed &amp; known &amp; the function gives us the *probability of getting different values of </span><span class="st">`</span>x<span class="st">`</span><span class="at">*. But in real-life, we observe </span><span class="st">`</span>x<span class="st">`</span><span class="at"> and it is </span><span class="st">`</span>lambda<span class="st">`</span><span class="at"> that is unknown. We want to find the </span><span class="st">`</span>lambda<span class="st">`</span><span class="at"> that makes the observed </span><span class="st">`</span>x<span class="st">`</span><span class="at"> the most likely. That is, given </span><span class="st">`</span>x<span class="st">`</span><span class="at">, what value of </span><span class="st">`</span>lambda<span class="st">`</span><span class="at"> gives us the highest value of </span><span class="st">`</span>log_likelihood<span class="st">`</span><span class="at">()?</span></span>
<span id="cb37-685"><a href="#cb37-685"></a></span>
<span id="cb37-686"><a href="#cb37-686"></a><span class="st">```</span> r</span>
<span id="cb37-687"><a href="#cb37-687"></a>X <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">lambda =</span> <span class="fl">0.3</span>) <span class="co"># &lt;1&gt;</span></span>
<span id="cb37-688"><a href="#cb37-688"></a>lambda <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">100</span>) <span class="co"># &lt;1&gt;</span></span>
<span id="cb37-689"><a href="#cb37-689"></a></span>
<span id="cb37-690"><a href="#cb37-690"></a>M <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(lambda, <span class="sc">~</span><span class="fu">log_likelihood</span>(<span class="at">lambda =</span> .x, X)) <span class="co"># &lt;2&gt;</span></span>
<span id="cb37-691"><a href="#cb37-691"></a>best_value <span class="ot">&lt;-</span> lambda[M <span class="sc">==</span> <span class="fu">reduce</span>(M, max)] <span class="co"># &lt;2&gt;</span></span>
<span id="cb37-692"><a href="#cb37-692"></a></span>
<span id="cb37-693"><a href="#cb37-693"></a><span class="co"># alternate approach</span></span>
<span id="cb37-694"><a href="#cb37-694"></a><span class="fu">optimise</span>(log_likelihood, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">x =</span> X, <span class="at">maximum =</span> <span class="cn">TRUE</span>) <span class="co"># &lt;3&gt;</span></span>
<span id="cb37-695"><a href="#cb37-695"></a><span class="st">```</span></span>
<span id="cb37-696"><a href="#cb37-696"></a><span class="at">1.  Generate poisson random numbers &amp; selecting a random set of </span><span class="st">`</span>lambda<span class="st">`</span></span>
<span id="cb37-697"><a href="#cb37-697"></a><span class="at">2.  Finding the best value.</span></span>
<span id="cb37-698"><a href="#cb37-698"></a><span class="at">3.  Automates the process of finding the best value. It will evaluate </span><span class="st">`</span><span class="fu">log_likelihood</span>()<span class="st">`</span><span class="at"> many times, using mathematical tricks to narrow in on the largest value as quickly as possible</span></span>
<span id="cb37-699"><a href="#cb37-699"></a></span>
<span id="cb37-700"><a href="#cb37-700"></a><span class="at">## Bias and MSE</span></span>
<span id="cb37-701"><a href="#cb37-701"></a></span>
<span id="cb37-702"><a href="#cb37-702"></a></span>
<span id="cb37-703"><a href="#cb37-703"></a><span class="at"># References</span></span>
<span id="cb37-704"><a href="#cb37-704"></a></span>
<span id="cb37-705"><a href="#cb37-705"></a><span class="at">&lt;https://purrr.tidyverse.org/reference/index.html&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="Functional Programming_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>